;-------------- Generated by Fighter Factory -------------
            ;Kung Fu Man by Elecbyte & DivineWolf



;--------------------- Variable List ----------------------

; Var(0) - StateDef 320, 331, 765, 766, 6010, 8600, 9999
; Var(1) - StateDef 331, 6010
; Var(2) - StateDef -2, 300, 331
; Var(3) - StateDef 40
; Var(4) - StateDef 180
; Var(5) - StateDef -3
; Var(6) - StateDef -3
; Var(7) - StateDef -3
; Var(8) - StateDef 1404
; Var(9) - StateDef -2
; Var(10) - StateDef 750, 1208, 331, 9999
; Var(11) - StateDef 331
; Var(12) - StateDef 331
; Var(13) - StateDef -2, 810, 331
; Var(14) - StateDef 45, 52, 70, 102, 103, -2
; Var(15) - StateDef -2, 810, 3000, 3002, 3025, 3026, 3100, 3110, 3200, 300
; Var(16) - StateDef -2, 810
; Var(17) - StateDef -2, 3000, 3002, 3025, 3026, 3100, 3110, 3200, 300
; Var(18) - StateDef -2, 1050
; Var(19) - StateDef 800, 805, 810, 830
; Var(20) - StateDef 770, -2, 1083, 1103, 1109, 1211, 1213, 1235, 1236, 1243, 1304, 331
; Var(21) - StateDef 3000, 3002, 3025, 3026, 3100, 3110, 3200, 300, 331
; Var(22) - StateDef 3000, 3002, 3025, 3026, 3100, 3110, 3200, 300, 331
; Var(23) - StateDef -3
; Var(24) - StateDef 770
; Var(25) - StateDef -3, 1083, 1103, 1109, 1211, 1213, 1235, 1236, 1243, 1304
; Var(26) - StateDef 760, 761, -3
; Var(27) - StateDef 1405, 1411
; Var(28) - StateDef 3350
; Var(30) - StateDef -2
; Var(31) - StateDef 1225, 1226, 1227, 1228, 1229, 1230
; Var(33) - StateDef 200, 210, 220, 221, 222, 240, 250, 400, 410, 420, 440, 450, 451, 600, 610, 620, 640, 650, 810, 1021, 1031, 1100, 1101, 1102, 1103, 1106, 1107, 1108, 1109, 1200, 1201, 1202, 1206, 1207, 1208, 1213, 1290, 1300, 1302, 1304, 1305, 1327, 3110, 3201, 3204, 3300, 3302, 3303, 3350, 3352, 331, 1601
; Var(34) - StateDef 200, 210, 220, 221, 222, 240, 250, 400, 410, 420, 440, 450, 451, 600, 610, 620, 640, 650, 810, 1021, 1031, 1100, 1101, 1102, 1103, 1106, 1107, 1108, 1109, 1200, 1201, 1202, 1206, 1207, 1208, 1213, 1240, 1241, 1242, 1243, 1290, 1300, 1302, 1304, 1305, 1327, 3110, 3201, 3204, 3300, 3302, 3303, 3350, 3352, 331, 1601
; Var(35) - StateDef 200, 210, 220, 221, 222, 240, 250, 400, 410, 420, 440, 450, 451, 600, 610, 620, 640, 650, 810, 1021, 1031, 1100, 1101, 1102, 1103, 1106, 1107, 1108, 1109, 1200, 1201, 1202, 1206, 1207, 1208, 1213, 1240, 1241, 1242, 1243, 1290, 1300, 1302, 1304, 1305, 1327, 3110, 3201, 3204, 3300, 3302, 3303, 3350, 3352, 331, 1601
; Var(40) - StateDef -3
; Var(41) - StateDef 1121
; Var(45) - StateDef 45
; Var(58) - StateDef -3

;--------------------- Float Variable List ----------------------

; fVar(0) - StateDef 9999
; fVar(1) - StateDef 9999
; fVar(5) - StateDef -3, 3000, 3002, 3025, 3026, 3100, 3110, 3200, 300
; fVar(10) - StateDef -2, 9999
; fVar(11) - StateDef -2, 9999
; fVar(20) - StateDef 9999
; fVar(21) - StateDef 9999

[Data]
life = 1000			;Amount of life to start with
attack = 100		;attack power (more is stronger)
defence = 100		;defensive power (more is stronger)
fall.defence_up = 50	;Percentage to increase defense everytime player is knocked down
liedown.time = 50		;Time which player lies down for, before getting up
airjuggle = 0		;Number of points for juggling
sparkno = s8010			;Default hit spark number for HitDefs
guard.sparkno = s8000	;Default guard spark number
KO.echo = 0			;1 to enable echo on KO
volume = 200			;Volume offset (negative for softer)
IntPersistIndex = 0;58	;Variables with this index and above will not have their values
FloatPersistIndex = 0;40  ;reset to 0 between rounds or matches. There are 60 int variables,
  				;indexed from 0 to 59, and 40 float variables, indexed from 0 to 39.
  				;If omitted, then it defaults to 60 and 40 for integer and float
  				;variables repectively, meaning that none are persistent, i.e. all
  				;are reset. If you want your variables to persist between matches,
  				;you need to override state 5900 from common1.cns.

[Size]
xscale = 1           ;Horizontal scaling factor.
yscale = 1           ;Vertical scaling factor.
ground.back = 15     ;Player width (back, ground)
ground.front = 16    ;Player width (front, ground)
air.back = 12        ;Player width (back, air)
air.front = 12       ;Player width (front, air)
height = 60          ;Height of player (for opponent to jump over)
attack.dist = 160    ;Default attack distance
proj.attack.dist = 90 ;Default attack distance for projectiles
proj.doscale = 0     ;Set to 1 to scale projectiles too
head.pos = -5, -90   ;Approximate position of head
mid.pos = -5, -60    ;Approximate position of midsection
shadowoffset = 0     ;Number of pixels to vertically offset the shadow
draw.offset = 0,0    ;Player drawing offset in pixels (x, y)

[Velocity]
walk.fwd  = 3.4     ;Walk forward
walk.back = -3.2   ;Walk backward
run.fwd  = 4.75, 0    ;Run forward (x, y)
run.back = -10,-4 ;Hop backward (x, y)
jump.neu = 0,-9.4		;Neutral jumping velocity (x, y)
jump.back = -3.5		;Jump back Speed (x, y)
jump.fwd = 3.5		;Jump forward Speed (x, y)
runjump.back = -7,-10
runjump.fwd = 7,-10
airjump.neu = 0,-8	;.
airjump.back = -3		;Air jump speeds (opt)
airjump.fwd = 3	        ;.

[Movement]
airjump.num = 1      ;Number of air jumps allowed (opt)
airjump.height = 35  ;Minimum distance from ground before you can air jump (opt)
yaccel = .42;9         ;Vertical acceleration
stand.friction = .85 ;Friction coefficient when standing
crouch.friction = .82;Friction coefficient when crouching

[Quotes]
victory1 = "Now, Please Cooperate."
victory2 = "Hardly a fight..."
victory3 = "You're finished!"
victory4 = "......"
victory5 = "I don't listen to lectures from losers."
victory6 = "It'll take more than that to best me."
victory7 = "How Boring..."
victory8 = "Destroying all threats to both Humans and Reploids, This is the duty of a Maverick Hunter."

;---------------------------------------------------------------------------
; Lose by Time Over
; CNS difficulty: basic
[Statedef 170]
type = S
ctrl = 0
anim = 170
velset = 0,0

[State 170, 1]
type = NotHitBy
trigger1 = 1
value = SCA
time = 1

;---------------------------------------------------------------------------
; Win state decider
; CNS difficulty: basic
[Statedef 180]
type = S

[state 180,1]
type = varrandom
trigger1 = MatchOver = 0
trigger1 = time = 0
v = 4
range = 1,1

[state 180,1]
type = varrandom
trigger1 = MatchOver = 1
v = 4
range = 2,2

[State 180, 1]
type = ChangeState
trigger1 = Time = 0 && var(4) = 1
value = 181+ (random%2)

[State 180, 3]
type = ChangeState
trigger1 = Time = 0 && var(4) = 2
value = 183

;---------------------------------------------------------------------------
; Win pose 1 - Bow
; CNS difficulty: basic
[Statedef 181]
type = S
ctrl = 0
anim = 181
velset = 0,0

[State 181, Voice]
type = PlaySnd
trigger1 = AnimElem = 3
value = 0, 21
channel = 0

[State 181, AssertSpecial]
type = AssertSpecial
trigger1 = time = [0, 200]
flag = roundnotover

; Win pose 2 - Epic Pose
; CNS difficulty: basic
[Statedef 182]
type = S
ctrl = 0
anim = 182
velset = 0,0

[State 182, Voice]
type = PlaySnd
trigger1 = AnimElem = 2
value = 0, 18
channel = 0

[State 182, AssertSpecial]
type = AssertSpecial
trigger1 = time = [0, 200]
flag = roundnotover

[State 181, AssertSpecial]
type = AssertSpecial
trigger1 = time > 108
flag = noshadow

[State 1105, PlaySnd]
type = PlaySnd
trigger1 = time = 108
value = S182,4

[State 182, Teleport]
type = helper
trigger1 = time > 108
stateno = 184
ID = 184
name = "Teleport"
postype = p1
pos = 0,0
size.xscale = 1.0
size.yscale = 1.0
ownpal = 1
persistent=0

;Win pose - MMX Victory
[Statedef 183]
type = S
ctrl = 0
anim = 0
velset = 0,0

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = Time <= 480
flag = roundnotover
flag2 = nomusic

[State 181, AssertSpecial]
type = AssertSpecial
trigger1 = time > 431
flag = noshadow

[State 181, 1]
type = playsnd
trigger1 = time = 0
value = 182,1
volume = 255

[State 0, ChangeAnim]
type = ChangeAnim
trigger1 = Time = 360
value = 183

[State 181, 1]
type = playsnd
triggerall = anim = 183
trigger1 = AnimElem = 5
value = 0,18;182,2

[State 182, Teleport]
type = helper
triggerall = anim = 183
trigger1 = AnimElem = 6
helpertype = normal
stateno = 184
ID = 184
name = "Teleport"
postype = p1
pos = 0,0
size.xscale = 1.0
size.yscale = 1.0
ownpal = 1
persistent=0

[State 1105, PlaySnd]
type = PlaySnd
triggerall = anim = 183
trigger1 = AnimElem = 5
value = S182,5
channel = 4

[State 1105, PlaySnd]
type = PlaySnd
triggerall = anim = 183
trigger1 = AnimElem = 6
value = S182,4
channel = 4

[State 181, 1]
type = NotHitBy
trigger1 = Time >= 0
value = SCA
time = 1

;-------------------------------------------------------------
;INITIALIZE
[Statedef 5900]
type = S

[State 5900, Varreset]
type = varrangeset
trigger1 = !roundsexisted
value = 0

[State 5900, Varreset]
type = varrangeset
trigger1 = !roundsexisted
fvalue = 0

[State 5900, Intro Decider]
type = ChangeState
triggerall = palno = [11,12]
trigger1 = RoundNo = 1
value = 191+ (random%4)

[State 5900, Intro Decider]
type = ChangeState
trigger1 = RoundNo = 1
value = 191+ (random%3)

[State 5900, End]
type = ChangeState
trigger1 = 1
value = 0

;---------------------------------------------------------------------------
;Motorcycle intro
[Statedef 191]
type = S
ctrl = 0
velset = 0,0

[State 190, 0]
type = ScreenBound
trigger1 = 1
value = 0

[State 192, 0] ;Assert this until you want "round 1, fight" to begin
type = AssertSpecial
trigger1 = time = 0
flag = Intro

[State 192, 0] ;Freeze animation until PreIntro is over
type = ChangeAnim
trigger1 = RoundState = 0
value = 8888

[State 192,so moto]
type = Playsnd
trigger1 = time = 2
value = 191,0

[State 19, moto]
type = explod
trigger1 = time =0
anim = 191
postype = p1
pos = -290,0;190
sprpriority = -5
removeongethit = 1
removetime = 70
vel = 10,0
accel = .05,0
scale = 1, 1

[State 192, conductor]
type = explod
trigger1 = time =0
anim = 193
postype = p1
pos = -307,-6;184
sprpriority = -4
removeongethit = 1
vel = 10,0
accel = .05,0
scale = 1, 1

[State 192,so salto]
type = Playsnd
trigger1 = Anim = 192
value = 100,5
persistent = 0

[State 192,salto];el salto
type = ChangeAnim
trigger1 = Time >=30
value = 192
persistent = 0

[State 192,salto]
type = Velset
trigger1 = Anim = 192
y = -10
persistent = 0

[State 192,salto2]
type = StateTypeSet
trigger1 = anim = 192
statetype = A
physics = A
persistent = 0

[State 192,landing1]
type = StateTypeSet
trigger1 = anim = 192
trigger1 = Pos Y >=-40
trigger1 = Vel Y >=0
statetype = S
physics = S
persistent = 0

[State 192,landing2];
type = ChangeAnim
trigger1 = anim = 192
trigger1 = statetype = S
trigger1 = statetype = S
value = 196

[State 52, Landing Dust Explod]
type = Explod
trigger1 = anim = 196 && animelem = 1
anim = 8102
sprPriority = -3
posType = P1
scale = 0.5,0.5
pauseMoveTime = -1
superMoveTime = -1
ownPal = 1

[State 0, PlaySnd]
type = PlaySnd
trigger1 = anim = 196
value = S20,1
volume = 0
channel = -1
persistent = 0

[State 192,landing3]
type = Velset
trigger1 = Anim = 196
y = 0
persistent = 0

[State 192,landing4]
type = Posset
trigger1 = anim = 196
Y = 0
persistent = 0

[State 192, 10] ;Change to stand state when done
type = ChangeState
trigger1 = animtime = 0
value = 0

;---------------------------
;Teleport Intro
[Statedef 192]
type = A
physics = N
ctrl = 0
anim = 194
velset = 0,0

[State 1105, PlaySnd]
type = PlaySnd
trigger1 =!time
value = S182,3
channel = 4

[State 181, AssertSpecial]
type = AssertSpecial
trigger1 = time = [0,28]
flag = noshadow

[State 181, AssertSpecial]
type = AssertSpecial
trigger1 = time = [0,162]
flag = intro

[State 192,so moto]
type = Playsnd
trigger1 = animelem = 8
value = 191,1

[State 182, Teleport]
type = helper
trigger1 = time > 0
stateno = 184
ID = 184
name = "Teleport"
postype = p1
pos = 0,0
size.xscale = 1.0
size.yscale = 1.0
ownpal = 1
persistent=0

[State 105, 3]
type = ChangeState
trigger1 = time > 162
value = 0

;---------------------------
; Boss/Sub-Boss Intro [Warning]
[Statedef 193]
type = S
ctrl = 0
anim = 190
velset = 0,0

[State 160, 0]
type = AssertSpecial
trigger1 = 1
flag = Intro

[State 160, 2]
type = ChangeAnim
trigger1 = 1
value = 190

[State 160, Warning]
type = Explod
trigger1 = Time = 10
id = 160
anim = 160
pos = 40,60
postype = Left
supermove = 1
persistent = 0
sprpriority = 5
ownpal = 1

[State 160, 3]
type = PlaySnd
trigger1 = Time = 10
value = 8, 0
channel = 2

[State 160, 4]
type = ChangeState
trigger1 = Time >= 100
value = 192

;---------------------------
; Nightmare Zero Intro (Only Pals 11 and 12)
[Statedef 194]
type = s
ctrl = 0
anim = 1190
velset = 0, 0
sprpriority = 0

[State 190]
type = playsnd
trigger1 = time = 20
value = s1190, 0
channel = 1

[State 190]
type = playsnd
trigger1 = time = 20
value = s1190, 1
channel = 0

[State 190]
type = changestate
trigger1 = animtime = 0
value = 0

;====================<TURNS INTRO>====================
[Statedef 6900]
type = A
anim = 39
velset = 0, 0
ctrl = 0

[State 6900, Intro]
type = assertspecial
trigger1 = 1
flag = intro

[State 6900, Camera]
type = screenbound
trigger1 = 1
value = 0
movecamera = 0, 0

[State 6900, Camera]
type = helper
trigger1 = !numhelper(8999)
helpertype = normal
stateno = 8999
ID = 8999
name = "Camera"
postype = p1

[State 6900, Pos]
type = posset
trigger1 = !time
x = (-320 + abs(pos x)) * facing

[State 6900, Vel]
type = velset
trigger1 = !time
x = (helper(8999), rootdist x) / -40.0
y = -10.25

[State 6900, Vel]
type = veladd
trigger1 = 1
y = 0.5

[State 6900, End]
type = changestate
trigger1 = time
trigger1 = pos y > -vel y
value = 6901

;---Land---
[Statedef 6901]
type = S
physics = S
anim = 196
velset = 0, 0

[State 6901, Intro]
type = assertspecial
trigger1 = 1
flag = intro

[State 6901, Pos]
type = posset
trigger1 = !time && numhelper(8999)
x = ceil(helper(8999), pos x)

[State 6901, Landing Snd]
type = Playsnd
trigger1 = !Time
value = 52,0

[State 6901, Landing Dust]
type = Explod
trigger1 = !Time
anim = 8102
sprpriority = -3
postype = p1
scale = .5,.5
pausemovetime = -1
supermovetime = -1
ownpal = 1

[State 6901, End]
type = ChangeState
trigger1 = !Animtime
value = 0

;-----------------------
; Taunt
; CNS difficulty: easy
[Statedef 195]
type = S
ctrl = 0
anim = 195
velset = 0,0
movetype = I
physics = S
sprpriority = 2

[State 700, SFX]
type = Playsnd
trigger1 = animelem = 3
value = 195,0

[State 195, End]
type = ChangeState
trigger1 = !AnimTime
value = 0
ctrl = 1

;=========<DODGE>=============
[Statedef 700]
type    = S
movetype= I
physics = S
juggle  = 0
velset = 0,0
ctrl = 0
anim = 700
sprpriority = -1

[State 700, SFX]
type = Playsnd
trigger1 = time = 3
value = 1,3
volume = 255

[State 710, Voice]
type = PlaySnd
trigger1 = AnimElem = 1
value = 0, ifElse(Random < 500, 14, 24)
channel = 0

[State 700, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 0

[State 700, HitBy]
type = HitBy
trigger1 = 1
value = SCA,AT
time = 1

[State 700, Attack]
type = ChangeState
trigger1 = Time = [15,25]
trigger1 = command = "x" || command = "y" || command = "z" || command = "a" || command = "b" || command = "c"
value = ifElse((command = "x" || command = "y" || command = "z"), 221, 224)

[State 700, End]
type = ChangeState
trigger1 = !AnimTime
value = 0
ctrl = 1

;=========<ROLLING>===========
[StateDef 710]
type = S
physics = N
moveType = I
anim = 710
ctrl = 0
velSet = 0,0
sprPriority = 1

[State 710, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 0

[State 710, HitBy]
type = HitBy
trigger1 = 1
value = SCA,AT
time = 1

[State 710, Voice]
type = PlaySnd
trigger1 = AnimElem = 1
value = 0, ifElse(Random < 500, 14, 24)
channel = 0

[State 710, Roll Sound]
type = PlaySnd
trigger1 = Time = 1
value = 110,0
channel = 1

[State 710, Start Roll]
type = VelSet
trigger1 = AnimElem = 1
x = 5

[State 710, End Roll]
type = VelSet
trigger1 = AnimElem = 6
x = 0

[State 710, End]
type = ChangeState
trigger1 = !AnimTime
value = 0
ctrl = 1

;Roll Back
[StateDef 715]
type = S
physics = N
moveType = I
anim = 715
ctrl = 0
velSet = 0,0
sprPriority = 1

[State 715, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 0

[State 715, HitBy]
type = HitBy
trigger1 = 1
value = SCA,AT
time = 1

[State 710, Voice]
type = PlaySnd
trigger1 = AnimElem = 1
value = 0, ifElse(Random < 500, 14, 24)
channel = 0

[State 715, Roll Sound]
type = PlaySnd
trigger1 = Time = 1
value = 110,0
channel = 1

[State 715, Start Roll]
type = VelSet
trigger1 = AnimElem = 1
x = -5

[State 715, Stop Roll]
type = VelSet
trigger1 = AnimElem = 6
x = 0

[State 715, End]
type = ChangeState
trigger1 = !AnimTime
value = 0
ctrl = 1

;===========<POWER CHARGE>==================
[StateDef 730]
type = S
physics = S
moveType = I
anim = 730
velSet = 0,0
ctrl = 0

[State 730, PowerAdd]
type = PowerAdd
triggerAll = Power < const(data.power) && Power < PowerMax
trigger1 = (command = "hold_b" && command = "hold_y")||var(54)
value = 5 + ifElse(time < 60, 0, (time - 60) / 12)

[State 730, Voice]
type = PlaySnd
trigger1 = !Time
value = 0,16
channel = 0

[State 730, Character Flash]
type = PalFX
trigger1 = 1
time = 1
add = 75 + ceil(sin(Time / 6.0 * pi) * 75),25 + ceil(sin(Time / 6.0 * pi) * 25),0

[State 730, Power Charge Helper]
type = Helper
trigger1 = !NumHelper(8330)
helperType = Normal
stateNo = 8330
ID = 8330
name = "Power Charge"
posType = P1
pos = 0,0
pauseMoveTime = 65535
superMoveTime = 65535
ownPal = 1

[State 730, Particles]
type = Helper
trigger1 = !NumHelper(8331)
helperType = Normal
stateNo = 8331
ID = 8331
name = "Particles"
postype = P1
pauseMoveTime = 65535
superMoveTime = 65535
ownPal = 1

[State 730, End]
type = ChangeState
trigger1 = Power >= const(data.power) || Power >= PowerMax || RoundState != 2
trigger2 = (command != "hold_b" || command != "hold_y")&&var(54)<=0
value = 731
ctrl = 1

;Power Charge End
[StateDef 731]
type = S
physics = S
moveType = I
anim = 731
velSet = 0,0
ctrl = 1

[State 731, StopSnd]
type = StopSnd
trigger1 = !Time
channel = 0

[State 730, Full Power Voice]
type = PlaySnd
trigger1 = !Time && Power >= const(data.power)
value = 0,13
channel = 0
persistent = 0

[State 730, End]
type = ChangeState
trigger1 = !AnimTime
value = 0
ctrl = 1

;====================<ZERO COUNTER>====================
[StateDef 750]
type = S
physics = S
moveType = I
anim = 750
velSet = 0,0
ctrl = 0
sprPriority = 2
powerAdd = -1000
faceP2 = 1

[State 750, High or Low]
type = VarSet
trigger1 = !Time
var(10) = (command = "412k")
ignoreHitPause = 1

[State 750, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA
time = 1

[State 750, PosFreeze]
type = PosFreeze
trigger1 = 1
value = 1

[State 750, Voice]
type = PlaySnd
trigger1 = !Time
value = 0,1
channel = 0

[State 750, Zero Counter FX Helper]
type = Helper
trigger1 = !Time
helperType = Normal
stateNo = 8350
ID = 8350
name = "Zero Counter"
posType = P1
pos = 20, -66
superMoveTime = 255
ownPal = 1

[State 750, SuperPause]
type = SuperPause
trigger1 = !Time
time = 15
moveTime = 15
p2DefMul = 1
anim = -1
sound = s750,0
darken = 0

[State 750, End]
type = ChangeState
trigger1 = Time >= 15
value = ifElse(var(10) = 1, 451, 222)

;====================<PARRY>====================
;Standing Parry
[StateDef 760]
type = S
physics = S
moveType = I
anim = 760
velSet = 0,0
ctrl = 0
sprPriority = 2
powerAdd = 78 * !var(20)
faceP2 = 1

[State 760, HitBy]
type = HitBy
trigger1 = 1
value = SCA,AT
time = 1

[State 760, Pause]
type = Pause
trigger1 = !Time
time = 15
moveTime = 15
endCmdBufTime = 15
pauseBg = 0

[State 760, Stop]
type = PosFreeze
trigger1 = 1
value = 1

[State 760, No Walking]
type = VarSet
trigger1 = 1
var(26) = 7

[State 760, Voice]
type = PlaySnd
trigger1= !Time
value = 0,15
channel = 0

[State 760, Parry Sound]
type = PlaySnd
trigger1 = !Time
value = 760,0

[State 760, Player Flash]
type = PalFX
trigger1 = !Time
add = 0,64,255
sinadd = 0,-64,-255,60
time = 15

[State 760, FX]
type = Explod
trigger1 = !Time
anim = 8360
sprPriority = 5
posType = P1
pos = ceil(15 * const(size.xScale)), ceil(-55 * const(size.yScale))
pauseMoveTime = -1
superMoveTime = -1
scale = 0.5,0.5
ownPal = 1

[State 760, saber FX]
type = Explod
trigger1 = animelem = 3
anim = 768
sprPriority = 5
posType = P1
pos = 8,-20
pauseMoveTime = -1
superMoveTime = -1
scale = .5,.5
ownPal = 1
ignorehitpause = 1
removetime = 10
removeongethit = 1

[State 760, EnvShake]
type = EnvShake
trigger1 = !Time
time = 0
ampl = 0

[State 760, End]
type = ChangeState
trigger1 = !AnimTime
value = 0
ctrl = 1

;Crouching Parry
[StateDef 761]
type = C
physics = C
moveType = I
anim = 761
velSet = 0,0
ctrl = 0
sprPriority = 2
powerAdd = 78 * !var(20)
faceP2 = 1

[State 761, HitBy]
type = HitBy
trigger1 = 1
value = SCA,AT
time = 1

[State 761, Pause]
type = Pause
trigger1 = !Time
time = 15
moveTime = 15
endCmdBufTime = 15
pauseBg = 0

[State 761, PosFreeze]
type = PosFreeze
trigger1 = 1
value = 1

[State 761, No Walk]
type = VarSet
trigger1 = 1
var(26) = 7

[State 761, Voice]
type = PlaySnd
trigger1 = !Time
value = 0,19
channel = 0

[State 761, Parry Sound]
type = PlaySnd
trigger1 = !Time
value = 760,0

[State 761, Player Flash]
type = PalFX
trigger1 = !Time
add = 0,64,255
sinAdd = 0,-64,-255,60
time = 15

[State 761, Parry FX]
type = Explod
trigger1 = !Time
anim = 8360
sprpriority = 5
postype = P1
pos = ceil(10 * const(size.xScale)), ceil(-37 * const(size.yScale))
pauseMovetime = -1
superMovetime = -1
scale = 0.5,0.5
ownpal = 1

[State 760, saber FX]
type = Explod
trigger1 = animelem = 2
anim = 768
sprPriority = 5
posType = P1
pos = 5,-5
pauseMoveTime = -1
superMoveTime = -1
scale = .5,.5
ownPal = 1
ignorehitpause = 1
removetime = 10
removeongethit = 1

[State 761, EnvShake]
type = EnvShake
trigger1 = !time
time = 0
ampl = 0

[State 761, End]
type = ChangeState
trigger1 = !AnimTime
value = 11
ctrl = 1


;Jumping Parry
[StateDef 762]
type = A
physics = N
moveType = I
anim = 762
ctrl = 0
sprPriority = 2
powerAdd = 78 * !var(20)
faceP2 = 1

[State 762, HitBy]
type = HitBy
trigger1 = 1
value = SCA,AT
time = 1

[State 762, Pause]
type = Pause
trigger1 = !Time
time = 15
moveTime = 15
endCmdBufTime = 15
pauseBg = 0

[State 762, PosFreeze]
type = PosFreeze
trigger1 = 1
value = 1

[State 762, Voice]
type = PlaySnd
trigger1 = !Time
value = 0,14
channel = 0

[State 762, Parry Sound]
type = PlaySnd
trigger1 = !Time
value = 760,0

[State 762, Player Flash]
type = PalFX
trigger1 = !Time
add = 0,64,255
sinadd = 0,-64,-255,60
time = 15

[State 762, Parry FX]
type = Explod
trigger1 = !Time
anim = 8360
sprPriority = 5
posType = P1
pos = ceil(20 * const(size.xScale)), ceil(-70 * const(size.yScale))
pauseMoveTime = -1
superMoveTime = -1
scale = 0.5,0.5
ownpal = 1

[State 760, saber FX]
type = Explod
trigger1 = animelem = 2
anim = 768
sprPriority = 5
posType = P1
pos = 15,-37
pauseMoveTime = -1
superMoveTime = -1
scale = .5,.5
ownPal = 1
ignorehitpause = 1
removetime = 10
removeongethit = 1

[State 762, EnvShake]
type = EnvShake
trigger1 = !Time
time = 0
ampl = 0

[State 762, End]
type = ChangeState
trigger1 = !AnimTime
value = 763
ctrl = 1

;Falling
[StateDef 763]
type = A
physics = N
movetype = I
anim = 763
ctrl = 1

[State 763, VelSet]
type = VelSet
trigger1 = !Time
x = ifElse(vel x > 2, 2, ifElse(vel x < -2, -2, vel x))
y = ifElse(vel y < -2, vel y, -2)

[State 763, Gravity]
type = Gravity
trigger1 = 1

[State 763, Landing]
type = ChangeState
trigger1 = pos y > -vel y
value=52

;===============<MAX Mode>===============
;Excel - Original combo
[Statedef 770]
type=U
physics=U
movetype=A
anim=770+(statetype=A)
ctrl=(statetype=A)
velset=ifelse((statetype=S),0,vel x),ifelse((statetype=S),0,vel y)
poweradd=-1000

[State 760, Snd]
type=playsnd
trigger1= !time
value=770,0
channel=0
volume=200

[State 760, Snd]
type=playsnd
trigger1= !time
value=4000,random%3

[State 760, Super Pause FX]
type=helper
trigger1= !time
helpertype=normal
stateno=7260
ID=7260
postype=p1
pos= 0,-67-(anim=771)*10
ownpal=1
size.xscale=1
size.yscale=1
persistent=0
supermovetime=9999

[State 760, superchargepause]
type=superpause
trigger1= !time
time=30
anim=-1
darken=0
movetime=30*(anim=770)

[State Corner Push]
type=varset
trigger1= !time
fvar(5)= 0

[State 760, var]
type=varset
trigger1= anim=770
trigger2= anim=771 && !time
var(20)=180

[State 760, nhb]
type=nothitby
trigger1= anim=770
trigger2= anim=771 && time<=1
time=8
value=SCA

[State 760, image]
type=afterimage
trigger1= anim=770 && time=30
trigger2= anim=771 && time=1
time=2
timegap=1
framegap=4
length=13
paladd=0,0,0
palmul=.75,.75,.75
palcontrast=64,128,192
palpostbright=0,0,0
trans=add1

[State 760, End]
type=changeanim
trigger1= anim=771 && !animtime
value=41+(vel x>0)+(vel x<0)*2
elem=7-(!vel x)*4
persistent=0

[State 760, Type]
type=statetypeset
trigger1= anim=[41,43]
statetype=A
physics=A

[State 760, End]
type=changestate
trigger1= anim=770 && !animtime
value=0
ctrl=1

;---------------------------------------------------------------------------
; Override common states (use same number to override) :
;---------------------------------------------------------------------------
;STANDING
[StateDef 0]
type = S
physics = S
moveType = I
velSet = 0,0
sprPriority = 0

[State 0, Remove Explods]
type = RemoveExplod
trigger1 = IsHelper

[State 0, Destroy Helpers]
type = DestroySelf
trigger1 = IsHelper

[State 0, ChangeAnim]
type = ChangeAnim
trigger1 = Anim != 0 && Anim != 5
trigger2 = Anim = 5 && !AnimTime
value = 0

[State 0, Dead]
type = ChangeState
trigger1 = !Alive
value = 5050

;====================<CROUCHING>====================
;Stand to Crouch
[StateDef 10]
type = C
physics = C
moveType = I
velSet = 0,0
sprPriority = 0

[State 10, ChangeAnim]
type = ChangeAnim
trigger1 = !Time && Anim = 12
value = 10
elem = 3 - AnimElemNo(0)

[State 10, ChangeAnim]
type = ChangeAnim
trigger1 = Anim != 10
value = 10

[State 10, End]
type = ChangeState
trigger1 = !AnimTime
value = 11


;Crouching
[StateDef 11]
type = C
physics = C
moveType = I
anim = 11
velSet = 0,0
sprPriority = 0

[State 11, ChangeAnim]
type = ChangeAnim
trigger1 = Anim = 6 && !AnimTime
value = 11


;Crouch to Stand
[StateDef 12]
type = S
physics = S
moveType = I
velSet = 0,0
sprPriority = 0

[State 12, ChangeAnim]
type = ChangeAnim
trigger1 = !Time && Anim = 10
value = 12
elem = 3 - AnimElemNo(0)

[State 12, ChangeAnim]
type = ChangeAnim
trigger1 = Anim != 12
value = 12

[State 12, End]
type = ChangeState
trigger1 = command = "holddown" && command != "holdup"
value = 10

[State 12, End]
type = ChangeState
trigger1 = !AnimTime
value = 0

;-------------
;WALKING
[StateDef 20]
type = S
physics = S
moveType = I
sprPriority = 0

[State 0, PlaySnd]
type = PlaySnd
triggerall = anim = 20
trigger1 = animelem = 2
trigger2 = animelem = 8
value = S20,0
volume = 300
freqmul = 1
channel = 1

[State 0, PlaySnd]
type = PlaySnd
triggerall = anim = 21
trigger1 = animelem = 3
trigger2 = animelem = 6
value = S20,0
volume = 300
freqmul = 1
channel = 1

[State 20, VelSet]
type = VelSet
trigger1 = command = "holdfwd"
x = const(velocity.walk.fwd.x)

[State 20, VelSet]
type = VelSet
trigger1 = command = "holdback"
x = const(velocity.walk.back.x)

[State 20, ChangeAnim]
type = ChangeAnim
triggerAll = vel x > 0
trigger1 = Anim != 20 && Anim != 5
trigger2 = Anim = 5 && AnimElemTime(1) >= 1
value = 20

[State 20, ChangeAnim]
type = ChangeAnim
triggerAll = vel x < 0
trigger1 = Anim != 21 && Anim != 5
trigger2 = Anim = 5 && AnimElemTime(1) >= 1
value = 21

;====================<JUMPING>====================
;Jumping

[StateDef 40]
type = S
physics = S
moveType = I
anim = 40
ctrl = 0
velSet = 0,0
sprPriority = 1
faceP2 = 1

[State 40, Remove Explod]
type = removeExplod
trigger1 = time = 0
ID = 400

[State 40, Direction]
type = VarSet
trigger1 = 1
sysvar(1) = ifElse(!Time, 0, ifElse(command = "holdfwd", 1, ifElse(command = "holdback", -1, sysvar(1))))

[State 40, High Jump]
type = VarSet
trigger1 = !Time
var(3) = ifElse(command = "highjump", 3, 0)

[State 40, High Jump]
type = VarSet
trigger1 = !Time && PrevStateNo = 100
var(3) = 3

[State 40, Low Jump]
type = VarSet
trigger1 = command != "holdup" && (var(3) != [1,2])
var(3) = ifElse((var(3) = 3 && sysvar(1)), 2, 1)

[State 40, Jump Sound]
type = PlaySnd
trigger1 = !AnimTime
value = ifElse((var(3) = [2,3]), 41, 40), 0

[State 40, Dust Helper]
type = Helper
trigger1 = !AnimTime
helperType = Normal
stateNo = 8100
ID = 8100
name = "Jump Dust"
posType = P1
ownPal = 1

[State 40, Velocity: Normal Jump]
type = VelSet
trigger1 = !AnimTime
x = ifElse(!sysvar(1), const(velocity.jump.neu.x), ifElse(sysvar(1) = 1, const(velocity.jump.fwd.x), const(velocity.jump.back.x)))
y = const(velocity.jump.y)

[State 40, Velocity: Low Jump]
type = VelSet
trigger1 = !AnimTime && var(3) = 1
x = ifElse(!sysvar(1), const(velocity.jump.neu.x), ifElse(sysvar(1) = 1, const(velocity.jump.fwd.x), const(velocity.jump.back.x)))
y = 0.75 * const(velocity.jump.y)

[State 40, Velocity: Long Low Jump]
type = VelSet
trigger1 = !AnimTime && var(3) = 2
x = ifElse(!sysvar(1), const(velocity.jump.neu.x), ifElse(sysvar(1) = 1, const(velocity.runjump.fwd.x), const(velocity.runjump.back.x)))
y = 0.75 * const(velocity.jump.y)

[State 40, Velocity: Long Jump]
type = VelSet
trigger1 = !AnimTime && var(3) = 3
x = ifElse(!sysvar(1), const(velocity.jump.neu.x), ifElse(sysvar(1) = 1, const(velocity.runjump.fwd.x), const(velocity.runjump.back.x)))
y = ifElse(!sysvar(1), const(velocity.runjump.y), const(velocity.jump.y))

[State 40, End]
type = ChangeState
trigger1 = !AnimTime
value = 50
ctrl = 1

;-------------------------------------------------------------------------------
; AirJump Start
[Statedef 45]
type    = A
physics = A

[State -2,Removeafterimage on get hit]
type = afterimagetime
trigger1 = prevstateno = 102
time = 0

[State 0, Explod]
type = removeExplod
trigger1 = time = 0
id = 600

[State 0, Explod]
type = removeExplod
trigger1 = time = 0
id = 42

[State 0, VarSet]
type = VarSet
trigger1 = time = 0
v = 14
value = 1

[State 0, VarSet]
type = VarSet
trigger1 = time
v = 45
value = 1

[State 0, CtrlSet]
type = CtrlSet
trigger1 = var(45) = 1
value = 1

[State 45, 3]
type = VarSet
trigger1 = Time = 0
sysvar(1) = 0

[State 45, 4]
type = VarSet
trigger1 = command = "holdfwd"||var(54)
sysvar(1) = 1

[State 45, 5]
type = VarSet
trigger1 = command = "holdback"&&var(54)<=0
sysvar(1) = -1

[State 0, ChangeAnim]
type = ChangeAnim
trigger1 = !time
value = ifelse(sysvar(1) = -1, 38, 39)

[State 45, 6]
type = VelSet
trigger1 = Time = 0
x = ifelse(sysvar(1)=0, const(velocity.airjump.neu.x), ifelse(sysvar(1)=1, const(velocity.airjump.fwd.x), const(velocity.airjump.back.x)))
y = const(velocity.airjump.y)

[State 45, PlaySnd]
type = PlaySnd
trigger1 = time = 0
value = S7000,0
volume = 0
channel = -1

[State 50, Additional Gravity]
type = VelAdd
trigger1 = var(1) = 1
y = .4

[State 45, 7]
type = ChangeState
trigger1 = !animtime
value = 50
ctrl = 1

;-------------------------------------------------------------------------------
;In Air
[StateDef 50]
type = A
physics = N
moveType = I
sprPriority = 1
ctrl=ifelse(var(54)||ctrl=0,0,1)

[State 50, ChangeAnim]
type = ChangeAnim
trigger1 = !Time
value = ifElse(!vel x , 41, ifElse(vel x > 0, 42, 43)) + 10 * (var(3) = [1,2])
persistent = 0

[State 50, Assert: No Guard]
type = AssertSpecial
trigger1 = var(3) = [1,2]
flag = NoAirGuard

[State 50, Grounded Frame]
type = PosFreeze
trigger1 = Time < 1 && PrevStateNo = 40
value = 1

[State 50, Gravity]
type = Gravity
trigger1 = Time >= 1 || PrevStateNo != 40

[State 50, Landing]
type = ChangeState
trigger1 = pos y > -vel y
value = 52

;-------------------------------------------------------------------------------
[StateDef 51]
type = A
physics = N
moveType = I
sprPriority = 1
ctrl=ifelse(var(54)||ctrl=0,0,1)

[State 51, Gravity]
type = Gravity
trigger1 = 1

[State 51, Landing]
type = ChangeState
trigger1 = pos y > -vel y
value = 52

;-------------------------------------------------------------------------------
;Landing
[StateDef 52]
type = S
physics = S
moveType = I
anim = 47
ctrl = 0
velSet = 0,0
sprPriority = 1

[State 0, VarSet]
type = VarSet
trigger1 = time = 0
v = 14
value = 0

[State 0, Explod]
type = Explod
triggerall = prevstateno = 1213
trigger1 = animelem = 1
anim = 3415
pos = 30,-20
postype = p1  ;p2,front,back,left,right
bindtime = 1
scale = .5,.5
vel = 0, 0
accel = 0, 0
removetime = -2
scale = 1,1
sprpriority = 3
ownpal = 1
removeongethit = 1
ignorehitpause = 1
bindtime = -1
ownpal = 1

[State 0, PlaySnd]
type = PlaySnd
triggerall = prevstateno = 1213
trigger1 = !time
value = S7,3
channel = 2

[State 624, Helper]
type = removeexplod
trigger1 = time = 0
ID = 1099

[State 0, Explod]
type = removeExplod
trigger1 = time = 0
id = 6000

[State 0, Explod]
type = removeExplod
trigger1 = time = 0
id = 600

[State 52, ChangeAnim]
type = ChangeAnim
trigger1 = !Time && (var(3) = 1 || var(3) = 2)
trigger1 = (PrevStateNo = [600,699])
value = 47

[State 52, PosSet]
type = PosSet
trigger1 = 1
y = 0

[State 52, CtrlSet]
type = CtrlSet
trigger1 = !Time && (PrevStateNo != [600,699])
trigger2 = Time = 1 && Anim != 57
value = 1

[State 52, ChangeState to Guarding]
type = ChangeState
trigger1 = ctrl && command = "holdback"
trigger1 = InGuardDist && (PrevStateNo != [600,699])
value = 120

[State 52, Assert: NoWalk]
type = AssertSpecial
trigger1 = anim != 5
flag = NoWalk

[State 52, Landing Sound]
type = PlaySnd
trigger1 = !Time
value = 52,0

[State 52, Landing Sound]
type = PlaySnd
trigger1 = !Time
value = 20,1

[State 52, Landing Dust Explod]
type = Explod
trigger1 = !Time
anim = 8102
sprPriority = -3
posType = P1
scale = 0.5,0.5
pauseMoveTime = -1
superMoveTime = -1
ownPal = 1

[State 52, ChangeAnim to Turning]
type = ChangeAnim
trigger1 = ctrl && P2Dist x < 0
trigger1 = Anim != 5
value = 5

[State 52, Turn]
type = Turn
trigger1 = Anim = 5 && AnimElem = 1

[State 52, End]
type = ChangeState
trigger1 = !AnimTime
value = 0
ctrl = 1

;=============================<WALL JUMP>======================================
;Wall Jump
[Statedef 60]
type = A
physics = N
velset = 0,0
anim = 60
ctrl = 0

[State 0, Explod]
type = removeExplod
trigger1 = time = 0
id = 600

[State 0, Explod]
type = removeExplod
trigger1 = time = 0
id = 42

[State 60, 0]
type = Turn
trigger1 = FrontEdgeBodyDist <= 0 && time = 0

[State 40, Jump Sound]
type = PlaySnd
trigger1 = !AnimTime
value = s40, 0

[State 60, 0]
type = playsnd
trigger1 = time = 0
value = 60,0

[State 60, 1]
type = PosAdd
trigger1 = AnimTime = 0
x = 20

[State 60, 1]
type = VelSet
trigger1 = AnimTime = 0
x = const(velocity.jump.fwd.x)
y = const(velocity.jump.y)

[State 60, 2]
type = ChangeState
trigger1 = AnimTime = 0
value = 50
ctrl = 1

;=============================<SUPER JUMP>======================================
;Beginning of the super jump
[Statedef 70]
type = S
physics = S
anim = 40
ctrl = 0
sprpriority = 1

[State 0, VarSet]
type = VarSet
trigger1 = time = 0
v = 14
value = 1

[State 972, RemoveExplod]
type = RemoveExplod
trigger1 = time = 0
id = 7006

[State 7001, Explod]
type = Explod
trigger1 = AnimElem = 1
anim = 7000
pos = 0,20
removetime = 12
sprpriority = 2
ownpal = 1
removeongethit = 0

[State 45, 3]
type = VarSet
trigger1 = Time = 0
sysvar(1) = 0

[State 45, 4]
type = VarSet
trigger1 = command = "holdfwd"||var(54)
sysvar(1) = 1

[State 45, 5]
type = VarSet
trigger1 = command = "holdback"&&var(54)<=0
sysvar(1) = -1

[State 7000, ChangeState]
type = ChangeState
trigger1 = AnimTime = 0
value = 71
ctrl = 1

;---------------------------------------------------------------------------------------------
;Super Jump
[Statedef 71]
type = A
physics = A
ctrl = 1
anim = 55
velset = 0,-15

[State 0, PlaySnd]
type = PlaySnd
trigger1 = time = 1
value = S100,5
volume = 255
channel = 1

[State 7001, VelAdd]
type = VelAdd
triggerall = Vel X >= -2
trigger1 = command = "holdback"&&var(54)<=0
x = -2

[State 7001, VelAdd]
type = VelAdd
triggerall = Vel X <= 2.5
trigger1 = command = "holdfwd"||var(54)
x = 2

[State 0, VelAdd]
type = VelAdd
trigger1=var(54)<=0
trigger1 = command != "holdfwd" || command != "holdback"
x = 0

[State 7001, VelAdd]
type = VelAdd
trigger1 = Vel Y > 0
y= - 0.17

;=============<RUNNING - DASH>====================
;Dash
[Statedef 100]
type    = S
physics = N
anim = 100
ctrl = 0

[State 0, Explod]
type = Explod
trigger1 = animelem = 2
anim = 1021
pos = -60,-30
postype = p1
bindtime = -1
facing = 1
supermovetime = 9999
pausemovetime = 9999
removetime = -1
sprpriority = 5
removeongethit = 1
scale = 1,1
ID = 400
ownpal = 1

[State 0, Explod]
type = Explod
trigger1 = time = 0
anim = 7023
pos = 0,0
postype = p1
bindtime = 1
supermovetime = 9999
pausemovetime = 9999
removetime = -2
sprpriority = 5
removeongethit = 0
scale = .3,.3
ownpal = 1

[State 1, dust]
type = Explod
trigger1 = !time
anim = 7502
ID = 1056
pos = 10,1
postype = p1
supermove = 1
scale = .4,.30
removeongethit = 1
ownpal = -1
sprpriority = 5
pausemovetime = -1
ignorehitpause = 1

[State 1, dust]
type = Explod
trigger1 = timemod = 3,0
anim = 7502
ID = 1056
pos = -10,1
postype = p1
supermove = 1
scale = .2,.1
removeongethit = 1
ownpal = -1
sprpriority = 5
pausemovetime = -1
ignorehitpause = 1

[State 100, 1]
type = PlaySnd
trigger1 = Time = 1
value = 100,3

;[State 100, 9]
;type = MakeDust
;trigger1 = Time = 1
;pos = -25,-2
;spacing = 1

;[State 100, 10]
;type = MakeDust
;trigger1 = AnimElem = 1, >= 0
;pos = -15,-2

[State 100, 1]
type = AssertSpecial
trigger1 = Anim = 100
flag = NoWalk

[State 101, 1]
type = VelSet
trigger1 = 1
x = 8

[State 100, AnimTime]
type = ChangeState
trigger1 = command = "holdup" && var(54)<=0
value = 40
ctrl = 1

[State 100, AnimTime]
type = ChangeState
trigger1 = command = "back" && var(54)<=0
value = 101
ctrl = 0

[State 100, No Walk During Run]
type = AssertSpecial
trigger1 = 1
flag = NoWalk

[State 100, 6]
type = ChangeState
trigger1 = time = 35
value = 101
ctrl = 1

;-------------------------------------------------------------------------------
;Run Stop
[Statedef 101]
type = S
movetype = I
physics = S

[State 0, Explod]
type = removeExplod
trigger1 = time = 0
id = 400

[State 52, 2]
type = VelSet
triggerall = prevstateno = 1320
trigger1 = Time = 0
x = 0
y = 0

[State 52, 3]
type = PosSet
triggerall = prevstateno = 1320
trigger1 = Time = 0
y = 0

[State 101, Skid Snd]
type = PlaySnd
trigger1 = animelem = 2
value = 101,1

[State 105, Dust Helper]
type = Helper
trigger1 = animelem = 2
helperType = Normal
stateNo = 8103
ID = 8100
POS = 20,0
name = "Dash Dust"
posType = P1
facing = -1
pauseMoveTime = 255
superMoveTime = 255
ownPal = 1

[State 101, ChangeAnim]
type = ChangeAnim
trigger1 = !Time
value = 101

[State 101, End]
type = ChangeState
trigger1 = !AnimTime
value = 0
ctrl = 1

;-------------------------------------------------------------------------------
; Air dash
[Statedef 102]
type    = A
physics = N
anim = 100
ctrl = 1
velset = 0,0

[State 0, VarSet]
type = VarSet
trigger1 = time = 0
v = 14
value = 1

[State 4110, 6]
type = AfterImage
triggerall = NumHelper(330) = 0
trigger1 = time = 0
time = 30
TimeGap  = 1
FrameGap = 4
length = 15
palbright=0,0,0
paladd=0,0,0
palmul=.9,.9,.9
PalContrast = 180,70,70
palpostbright=0,0,0
trans=add1

[State 0, Explod]
type = Explod
trigger1 = animelem = 2
anim = 1021
pos = -60,-30
postype = p1
bindtime = -1
facing = 1
supermovetime = 9999
pausemovetime = 9999
removetime = 30
sprpriority = 5
removeongethit = 1
scale = 1,1
ID = 600
ownpal = 1

[State 100, 1]
type = PlaySnd
trigger1 = Time = 1
value = 7000,1

[State 100, 1]
type = PlaySnd
trigger1 = Time = 25
value = 11,9

[State 100, 2]
type = VelSet
trigger1 = Time >= 0
trigger1 = AnimElem = 2, < 0
x = 8.3

[State 100, 3]
type = VelMul
trigger1 = AnimElem = 2, >= 0
x = 1.1
y = 0

[State 100, 4]
type = VelMul
trigger1 = AnimElem = 3, >= 0
x = .80
y = 0

[State 100, 5]
type = CtrlSet
trigger1 = AnimTime = -2
value = 1

[State 100, 6]
type = ChangeState
trigger1 = AnimTime = 0
value = 104
ctrl = 0

;-------------------------------------------------------------------------------
;Air Dash Back
[Statedef 103]
type    = A
physics = A
anim = 103
ctrl = 1

[State 0, VarSet]
type = VarSet
trigger1 = time
v = 14
value = 1

[State 108, 1]
type = VelSet
trigger1 = Anim = 103
x = -5.7
y = 0

[State 0, Explod]
type = Explod
trigger1 = animelem = 2
anim = 9150
ID = 600
pos = -5,9;40,2
facing = 1
postype = p1  ;p2,front,back,left,right
bindtime = -1
removetime = -1
supermovetime = 9999
pausemovetime = 9999
scale = 1,1
sprpriority = -1
ownpal = 1
removeongethit = 1

[State 0, Explod]
type = Explod
trigger1 = animelem = 2
anim = 9151
ID = 600
pos = 0,30;40,2
facing = 1
postype = p1  ;p2,front,back,left,right
bindtime = -1
removetime = -1
supermovetime = 9999
pausemovetime = 9999
scale = 1,1
sprpriority = -1
ownpal = 1
removeongethit = 1

[State 108, dust]
type = Explod
trigger1 = Time % 2 = 0
anim = 8104
pos = 30, -50
postype = p1
vel = -1,0
random = 20,70
removetime = -2
sprpriority = 3
scale = .36,.14
ownpal = 1

[State 108, Spark]
type = Explod
trigger1 = Time % 4 = 0
anim = 8104
pos = 30, -50
postype = p1
vel = -1,0
random = 20,70
removetime = -2
sprpriority = 3
scale = .32,.12
ownpal = 1

[State 108, PlaySnd]
type = PlaySnd
trigger1 = time=1
value = 100,4
volume = 0
channel = -1

[State 108, asserts]
type=assertspecial
trigger1= 1
flag=noairguard

[State 108]
type = ChangeState
triggerall = GetHitVar(yaccel) > 0
trigger1 = AnimTime = 0
trigger2= animelemtime(2)>0 && vel x<0 && backedgebodydist<=0
trigger3= animelemtime(2)>0 && vel x>0 && frontedgebodydist<=0
value = 104
ctrl = 0

;---------------------------------------------------------------------------
;Air Dash Fall (after a move)
[Statedef 104]
type    = A
physics = A
anim = 41
ctrl = 1

[state 99, 1]
type = removeexplod
trigger1 = time = 0
ID = 600

[state 99, 1]
type = VelAdd
triggerall = PrevStateno != 60
trigger1 = Time = 0
y = -0.08

;-------------------------------------------------------------------------------
;Hop Back
[Statedef 105]
type = S
movetype = I
physics = S
anim = 105
ctrl = 0
velset = 0, 0

[State 105, StateTypeSet];Air, no physics
type = StateTypeSet
trigger1 = AnimElem = 2
statetype = A
physics = N

[State 105, Dust Helper]
type = Helper
trigger1 = AnimElem = 2
helperType = Normal
stateNo = 8103
ID = 8100
name = "Dash Dust"
posType = P1
facing = -1
pauseMoveTime = 255
superMoveTime = 255
ownPal = 1

[State 105, VelSet]
type = VelSet
trigger1 = AnimElem = 2
x = Const(velocity.run.back.x)
y = Const(velocity.run.back.y)

[State 105, Gravity]
type = VelAdd
trigger1 = AnimElem = 2 > 0
y = .58

[State 105, Dash Back Snd]
type = PlaySnd
trigger1 = AnimElem = 2
value = 105, 0

[State 105, VelAdd]
type = VelSet
trigger1 = AnimElem = 2 > 0
trigger1 = Vel Y > 0 && Pos Y >= 0
x = 0

[State 105, On Ground]
type = PosSet
trigger1 = AnimElem = 2 > 0
trigger1 = Vel Y > 0 && Pos Y >= 0
y = 0

[State 105, End]
type = ChangeState
trigger1 = AnimElem = 2 > 0
trigger1 = Vel Y > 0 && Pos Y >= 0
value = 106

;-------------------------------------------------------------------------------
;Hop Back Landing
[Statedef 106]
type = S
movetype = I
physics = S
anim = 106
velset = 0, 0

[State 106, Landing Sound]
type = PlaySnd
trigger1 = !Time
value = 20,1

[State 106, Landing Dust Explod]
type = Explod
trigger1 = !Time
anim = 8102
sprpriority = -3
postype = P1
scale = 0.5,0.5
pauseMoveTime = -1
superMoveTime = -1
ownPal = 1

[State 106, End]
type = ChangeState
trigger1 = !AnimTime
value = 0
ctrl = 1

;=====================<HIT GROUND(BOUNCE)>===================
[Statedef 5100]
type    = L
movetype= H
physics = N

[State 5100, 1]
type = VelSet
trigger1 = Time = 0
trigger1 = GetHitVar(fall.yvel) = 0
trigger1 = vel x > 1
x = 1

[State 5100, EnvShake]
type = FallEnvShake
trigger1 = Time = 0

[State 5100, Var] ;Save fall velocity
type = VarSet
trigger1 = Time = 0
sysvar(1) = floor(vel y)

[State 5100, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
trigger1 = (anim != [5051,5059]) && (anim != [5061,5069])
trigger2 = !SelfAnimExist(5100 + (anim % 10))
value = 5100

[State 5100, 3] ;Hit ground anim (for hit up)
type = ChangeAnim
trigger1 = time = 0
trigger1 = (anim = [5051,5059]) || (anim = [5061,5069])
trigger1 = SelfAnimExist(5100 + (anim % 10))
value = 5100 + (anim % 10)

[State 5100, 4]
type = PosSet
trigger1 = Time = 0
y = 0

[State 5100, 5]
type = VelSet
trigger1 = Time = 0
y = 0

[State 5100, 6] ;Reduce speed
type = VelMul
trigger1 = Time = 0
x = 0.75

[State 5100, 7]
type = ChangeState
trigger1 = Time = 0
trigger1 = GetHitVar(fall.yvel) = 0
value = 5110 ;HIT_LIEDOWN

[State 5100, 8]
type = GameMakeAnim
trigger1 = Time = 1
value = 60 + (sysvar(1) > 5) + (sysvar(1) > 14)
pos = 0, 0
under = sysvar(1) <= 14

[State 5100, 9]
type = HitFallDamage
trigger1 = Time = 3

[State 5100, 10] ;Thud sound for when char hits ground
type = PlaySnd
trigger1 = Time = 1
value = 5000,11

[State 5100, 11]
type = PosFreeze
trigger1 = 1

[State 5100, 12]
type = ChangeState
trigger1 = AnimTime = 0
value = 5101

[State 5100, 13]
type = ForceFeedback
trigger1 = Time = 0
waveform = sinesquare
ampl = 128,-3,-.2,.005
time = 20

;================<HIT LIEDOWN>====================
[Statedef 5110]
type    = L
movetype= H
physics = N

[State 5110, EnvShake]
type = FallEnvShake
trigger1 = Time = 0

[State 5110, 1] ;For hit up/up-diag type (from state 5081)
type = ChangeAnim
persistent = 0
trigger1 = SelfAnimExist(5110 + (anim % 10))
trigger1 = anim = [5081,5089]
value = 5110 + (anim % 10)

[State 5110, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim != [5161,5169]
trigger2 = !SelfAnimExist(5170 + (anim % 10))
value = 5170

[State 5110, 3] ;Hit ground anim (for hit up)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim = [5161,5169]
trigger1 = SelfAnimExist(5170 + (anim % 10))
value = 5170 + (anim % 10)

[State 5110, 4]
type = HitFallDamage
trigger1 = Time = 0

[State 5110, 5]
type = PosSet
trigger1 = Time = 0
y = 0

[State 5110, Var] ;Get fall velocity
type = VarSet
trigger1 = Time = 0
trigger1 = GetHitVar(fall.yvel) != 0
sysvar(1) = floor(vel y)

[State 5110, 6] ;Thud sound for when char hits ground
type = PlaySnd
trigger1 = Time = 0
trigger1 = !SysVar(0)
value = 5000,11

[State 5110, 7]
type = GameMakeAnim
trigger1 = Time = 0
trigger1 = !SysVar(0)
value = 60 + (sysvar(1) > 5) + (sysvar(1) > 14)
pos = 0, 0
under = sysvar(1) <= 14

[State 5110, 8]
type = VelSet
trigger1 = Time = 0
y = 0

[State 5110, 9] ;For hit up type
type = ChangeAnim
persistent = 0
triggerall = anim = [5171,5179]
triggerall = SelfAnimExist(5110 + (anim % 10))
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground anim
value = 5110 + (anim % 10)

[State 5110, 10] ;For normal
type = ChangeAnim
persistent = 0
triggerall = Anim != [5111,5119]
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
value = 5110

[State 5110, 11] ;If just died
type = ChangeState
triggerall = !alive
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
trigger3 = Anim = [5110,5119]
value = 5150

[State 5110, 12]
type = VarSet
trigger1 = SysVar(0)
trigger1 = Time = 0
sysvar(0) = 0

[State 5110, 13] ;Friction
type = VelMul
trigger1 = 1
x = 0.85

[State 5110, 14]
type = ForceFeedback
trigger1 = alive
trigger1 = Time = 0
time = 8
ampl = 240
waveform = sine

[State 5110, 15]
type = ForceFeedback
trigger1 = !alive
trigger1 = Time = 0
ampl = 200, 7, -.467
time = 30
waveform = sine

;---------------------------------------------------------------------------
; HIT_LIEDEAD by Mr.Infinite
[Statedef 5150]
type    = L
movetype= H
physics = N
velset=0,0
sprpriority = -3

[State 5150, 1]
type = ChangeAnim
trigger1 = anim!=5150 && !matchover
value = 5150

[State 5150, 1]
type = ChangeAnim
trigger1 = anim!=5151 && matchover
value = 5151

[State 5150,Destroy]
type = Explod
trigger1 = time=20 && anim=5151
anim = 1500
id = 1500
postype = p1
pos = ceil(const(size.mid.pos.x)*const(size.xscale)),ceil(-5+const(size.mid.pos.y)*const(size.yscale))
ownpal = 1
bindtime = 1
sprpriority = -3
persistent = 0
velocity = 0, -2
removetime = 300
removeongethit = 1
scale=0.5,0.5

[State 5150,Destroy]
type = Explod
trigger1 = time=20 && anim=5151
anim = 1500
id = 1500
postype = p1
pos = ceil(-3+const(size.mid.pos.x)*const(size.xscale)),ceil(-3+const(size.mid.pos.y)*const(size.yscale))
ownpal = 1
bindtime = 1
sprpriority = -3
persistent = 0
velocity = -1.5, -1.5
removetime = 300
removeongethit = 1
scale=0.5,0.5

[State 5150,Destroy]
type = Explod
trigger1 = time=20 && anim=5151
anim = 1500
id = 1500
postype = p1
pos = ceil(-5+const(size.mid.pos.x)*const(size.xscale)),ceil(const(size.mid.pos.y)*const(size.yscale))
ownpal = 1
bindtime = 1
sprpriority = -3
persistent = 0
velocity = -2, 0
removetime = 300
removeongethit = 1
scale=0.5,0.5

[State 5150,Destroy]
type = Explod
trigger1 = time=20 && anim=5151
anim = 1500
id = 1500
postype = p1
pos = ceil(-3+const(size.mid.pos.x)*const(size.xscale)),ceil(3+const(size.mid.pos.y)*const(size.yscale))
ownpal = 1
bindtime = 1
sprpriority = -3
persistent = 0
velocity = -1.5, 1.5
removetime = 300
removeongethit = 1
scale=0.5,0.5

[State 5150,Destroy]
type = Explod
trigger1 = time=20 && anim=5151
anim = 1500
id = 1500
postype = p1
pos = ceil(const(size.mid.pos.x)*const(size.xscale)),ceil(5+const(size.mid.pos.y)*const(size.yscale))
ownpal = 1
bindtime = 1
sprpriority = -3
persistent = 0
velocity = 0, 2
removetime = 300
removeongethit = 1
scale=0.5,0.5

[State 5150,Destroy]
type = Explod
trigger1 = time=20 && anim=5151
anim = 1500
id = 1500
postype = p1
pos = ceil(3+const(size.mid.pos.x)*const(size.xscale)),ceil(3+const(size.mid.pos.y)*const(size.yscale))
ownpal = 1
bindtime = 1
sprpriority = -3
persistent = 0
velocity = 1.5, 1.5
removetime = 300
removeongethit = 1
scale=0.5,0.5

[State 5150,Destroy]
type = Explod
trigger1 = time=20 && anim=5151
anim = 1500
id = 1500
postype = p1
pos = ceil(5+const(size.mid.pos.x)*const(size.xscale)),ceil(const(size.mid.pos.y)*const(size.yscale))
ownpal = 1
bindtime = 1
sprpriority = -3
persistent = 0
velocity = 2, 0
removetime = 300
removeongethit = 1
scale=0.5,0.5

[State 5150,Destroy]
type = Explod
trigger1 = time=20 && anim=5151
anim = 1500
id = 1500
postype = p1
pos = ceil(3+const(size.mid.pos.x)*const(size.xscale)),ceil(-3+const(size.mid.pos.y)*const(size.yscale))
ownpal = 1
bindtime = 1
sprpriority = -3
persistent = 0
velocity = 1.5, -1.5
removetime = 300
removeongethit = 1
scale=0.5,0.5

[State 5150,Destroy]
type = Explod
trigger1 = time=20 && anim=5151
anim = 1500
id = 1500
postype = p1
pos = ceil(const(size.mid.pos.x)*const(size.xscale)),ceil(const(size.mid.pos.y)*const(size.yscale))
ownpal = 1
bindtime = 1
sprpriority = -3
persistent = 0
velocity = -0.5, -1
removetime = 300
removeongethit = 1
scale=0.5,0.5

[State 5150,Destroy]
type = Explod
trigger1 = time=20 && anim=5151
anim = 1500
id = 1500
postype = p1
pos = ceil(const(size.mid.pos.x)*const(size.xscale)),ceil(const(size.mid.pos.y)*const(size.yscale))
ownpal = 1
bindtime = 1
sprpriority = -3
persistent = 0
velocity = -1, -0.5
removetime = 300
removeongethit = 1
scale=0.5,0.5

[State 5150,Destroy]
type = Explod
trigger1 = time=20 && anim=5151
anim = 1500
id = 1500
postype = p1
pos = ceil(const(size.mid.pos.x)*const(size.xscale)),ceil(const(size.mid.pos.y)*const(size.yscale))
ownpal = 1
bindtime = 1
sprpriority = -3
persistent = 0
velocity = -0.5, 1
removetime = 300
removeongethit = 1
scale=0.5,0.5

[State 5150,Destroy]
type = Explod
trigger1 = time=20 && anim=5151
anim = 1500
id = 1500
postype = p1
pos = ceil(const(size.mid.pos.x)*const(size.xscale)),ceil(const(size.mid.pos.y)*const(size.yscale))
ownpal = 1
bindtime = 1
sprpriority = -3
persistent = 0
velocity = -1, 0.5
removetime = 300
removeongethit = 1
scale=0.5,0.5

[State 5150,Destroy]
type = Explod
trigger1 = time=20 && anim=5151
anim = 1500
id = 1500
postype = p1
pos = ceil(const(size.mid.pos.x)*const(size.xscale)),ceil(const(size.mid.pos.y)*const(size.yscale))
ownpal = 1
bindtime = 1
sprpriority = -3
persistent = 0
velocity = 0.5, 1
removetime = 300
removeongethit = 1
scale=0.5,0.5

[State 5150,Destroy]
type = Explod
trigger1 = time=20 && anim=5151
anim = 1500
id = 1500
postype = p1
pos = ceil(const(size.mid.pos.x)*const(size.xscale)),ceil(const(size.mid.pos.y)*const(size.yscale))
ownpal = 1
bindtime = 1
sprpriority = -3
persistent = 0
velocity = 1, 0.5
removetime = 300
removeongethit = 1
scale=0.5,0.5

[State 5150,Destroy]
type = Explod
trigger1 = time=20 && anim=5151
anim = 1500
id = 1500
postype = p1
pos = ceil(const(size.mid.pos.x)*const(size.xscale)),ceil(const(size.mid.pos.y)*const(size.yscale))
ownpal = 1
bindtime = 1
sprpriority = -3
persistent = 0
velocity = 0.5, -1
removetime = 300
removeongethit = 1
scale=0.5,0.5

[State 5150,Destroy]
type = Explod
trigger1 = time=20 && anim=5151
anim = 1500
id = 1500
postype = p1
pos = ceil(const(size.mid.pos.x)*const(size.xscale)),ceil(const(size.mid.pos.y)*const(size.yscale))
ownpal = 1
bindtime = 1
sprpriority = -3
persistent = 0
velocity = 1, -0.5
removetime = 300
removeongethit = 1
scale=0.5,0.5

[State 5150, AssertSpecial]
type = AssertSpecial
trigger1 = time>60 && anim=5151
flag = invisible

[State 5150, Flash]
type = PalFX
trigger1 = anim=5151 && animelem = 9
add = 255,255,255
sinAdd = -255,-255,-255,40
time=2

[State 6000, Fade]
type=trans
trigger1 = anim=5151
trigger2 =  time = 18
trans= addalpha
alpha= 256-(16*(time-16)), 16*(time-16)

[state 5150,snd]
type = playsnd
trigger1 = time=20 && anim=5151
value = 5150,0
volume=255

[State 5150, 4]
type = NotHitBy
trigger1 = 1
value = SCA
time = 1

[State 5150, PosSet]
type = PosSet
trigger1 = animelem=16 && anim=5151
y = 0


;==========<DARK HOLD CUSTOM STATES>==========
[Statedef 662]
type    = L
movetype= H
physics = N

[State 5100, 1]
type = VelSet
trigger1 = Time = 0
x = 0
y = 0

[State 5100, EnvShake]
type = FallEnvShake
trigger1 = Time = 0

[State 5100, Var] ;Save fall velocity
type = VarSet
trigger1 = Time = 0
sysvar(1) = floor(vel y)

[State 5100, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
trigger1 = (anim != [5051,5059]) && (anim != [5061,5069])
trigger2 = !SelfAnimExist(5100 + (anim % 10))
value = 5100

[State 5100, 3] ;Hit ground anim (for hit up)
type = ChangeAnim
trigger1 = time = 0
trigger1 = (anim = [5051,5059]) || (anim = [5061,5069])
trigger1 = SelfAnimExist(5100 + (anim % 10))
value = 5100 + (anim % 10)

[State 5100, 4]
type = PosSet
trigger1 = Time = 0
y = 0

[State 5100, 8]
type = GameMakeAnim
trigger1 = Time = 1
value = 60 + (sysvar(1) > 5) + (sysvar(1) > 14)
pos = 0, 0
under = sysvar(1) <= 14

[State 5100, 10]
type = null;PlaySnd
trigger1 = Time = 1
value = F7, (sysvar(1) > 5) + (sysvar(1) > 14)

[State 5100, 11]
type = PosFreeze
trigger1 = 1

[State 5100, 12]
type = ChangeState
trigger1 = AnimTime = 0
value = 663

;---------------------------------------------------------------------------
[Statedef 663]
type    = L
movetype= H
physics = N
velset = 0,-6.2

[State 5101, 1] ;Coming hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
trigger1 = anim != [5101,5109]
trigger2 = !SelfAnimExist(5160 + (anim % 10))
value = 5160

[State 5101, 2] ;Coming hit ground anim (for hit up)
type = ChangeAnim
triggerall = time = 0
trigger1 = anim = [5101,5109]
trigger1 = SelfAnimExist(5160 + (anim % 10))
value = 5160 + (anim % 10)

[State 5101, 3]
type = HitFallVel
trigger1 = Time = 0

[State 5101, 4]
type = PosSet
trigger1 = Time = 0
y = 0

[State 5101, 5] ;Acceleration
type = VelAdd
trigger1 = 1
y = .4

[State 5101, 6] ;Hit ground
trigger1 = Vel Y > 0
trigger1 = Pos Y >= 0
type = Changestate
value = 664

;---------------------------------------------------------------------------
; Lyingdown
[Statedef 664]
type    = L
movetype= H
physics = N
anim = 5110

[State 5110, 6]
type = PlaySnd
trigger1 = Time = 0
trigger1 = !SysVar(0)
;value = F7, 0 ;Hit ground
value = F7, (sysvar(1) > 5) + (sysvar(1) > 14)

[State 5110, 7]
type = GameMakeAnim
trigger1 = Time = 0
trigger1 = !SysVar(0)
value = 60 + (sysvar(1) > 5) + (sysvar(1) > 14)
pos = 0, 0
under = sysvar(1) <= 10

[State 5110, EnvShake]
type = FallEnvShake
trigger1 = Time = 0

[State 5110, 5]
type = PosSet
trigger1 = Time = 0
y = 0

[State 5110, Var] ;Get fall velocity
type = VarSet
trigger1 = Time = 0
trigger1 = GetHitVar(fall.yvel) != 0
sysvar(1) = floor(vel y)

[State 5110, 6]
type = PlaySnd
trigger1 = Time = 0
trigger1 = !SysVar(0)
;value = F7, 0 ;Hit ground
value = F7, (sysvar(1) > 5) + (sysvar(1) > 14)

[State 5110, 8]
type = VelSet
trigger1 = Time = 0
y = 0

[State 5110, 12]
type = VarSet
trigger1 = SysVar(0)
trigger1 = Time = 0
sysvar(0) = 0

[State 5110, 13] ;Friction
type = VelMul
trigger1 = 1
x = 0.85

[State 0, SelfState]
type = SelfState
trigger1 = time > 50
value = 5120
ctrl = 0
;ignorehitpause = 0
;persistent = 1

[State 5110, 11] ;If just died
type = SelfState
triggerall = !alive
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
trigger3 = Anim = [5110,5119]
value = 5150

;==========<FORCED P2 RECOVERY>==========
[StateDef 5025]
type = A
moveType = H
physics = N
velSet = 0,0
faceP2 = 1

[State 5025, HitFallSet]
type = HitFallSet
trigger1 = 1
value = 0

[State 5025, End]
type = SelfState
trigger1 = 1
value = ifElse(pos y, 5020, 5000)

;==========<TARGET SAFE FALL>==========
[StateDef 5205]
type = A
physics = N
moveType = H

[State 5205, End]
type = SelfState
trigger1 = 1
value = ifElse(pos y < -20, 5210, 5200)

;==========<FALL RECOVERY>==========
[StateDef 5200]
type = A
moveType = H
physics = N

[State 5200, ChangeAnim]
type = ChangeAnim
trigger1 = anim = 5035 && !AnimTime
value = 5050

[State 5200, VelAdd]
type = VelAdd
trigger1 = 1
y = GetHitVar(yAccel)

[State 5200, End]
type = SelfState
trigger1 = vel y > 0 && pos y >= 10
value = 5201

;-------------------------------------------------------------------------------
[StateDef 5201]
type = S
moveType = I
physics = N
anim = 5200
ctrl = 0
faceP2 = 1

[State 5201, PosSet]
type = PosSet
trigger1 = 1
y = 0

[State 5201, VelSet]
type = VelSet
trigger1 = !Time
x = -8
y = 0

[State 5201, VelMul]
type = VelMul
trigger1 = 1
x = 0.9

[State 5201, Voice]
type = PlaySnd
trigger1 = !Time
value = 143,0
channel = 0

[State 5201, Recover Sound]
type = PlaySnd
trigger1 = !Time
value = 5200,0
channel = 1

[State 5201, Flash]
type = PalFX
trigger1 = !Time
add = 255,255,255
sinAdd = -255,-255,-255,40
time=10

[State 5201, Recover FX]
type = Helper
trigger1 = !Time
helperType = Normal
stateNo = 8200
ID = 8200
name = "Recover FX"
posType = P1
pos = 0, ceil(-18 * const(size.yScale))
size.xScale = 1
size.yScale = 1
ownpal = 1

[State 5201, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA
time = 1

[State 5201, End]
type = ChangeState
trigger1 = !AnimTime
value = 0
ctrl = 1

;-------------------------------------------------------------------------------
;Air Recover
[StateDef 5210]
type = A
moveType = I
physics = N
anim = 5210
ctrl = 0
faceP2 = 1

[State 5210, VelAdd]
type = VelAdd
trigger1 = 1
y = 0.6

[State 5210, VelSet]
type = VelSet
trigger1 = !Time
x = ifElse((command = "holdfwd" && command != "holdback"), 0, ifElse((command != "holdfwd" && command = "holdback"), -4, -2))
y = -7.55

[State 5210, Voice]
type = PlaySnd
trigger1 = !Time
value = 1300,0
channel = 0

[State 5210, Recover Sound]
type = PlaySnd
trigger1 = !Time
value  = 5200,0
channel = 1

[State 5210, Flash]
type = PalFX
trigger1 = !Time
add = 255,255,255
sinAdd = -255,-255,-255,40
time = 10

[State 5210, Recover FX]
type = Helper
trigger1 = !Time
helperType = Normal
stateNo = 8200
ID = 8200
name = "Recover FX"
posType = P1
pos = 0, ceil(-66 * const(size.yScale))
size.xScale = 1
size.yScale = 1
ownPal = 1

[State 5210, NotHitBy]
type = NotHitBy
trigger1 = AnimElemTime(8) < 0
value = SCA
time = 1

[State 5210, CtrlSet]
type = CtrlSet
trigger1 = AnimElemTime(8) >= 0
value = 1

[State 5210, Land]
type = ChangeState
trigger1 = pos y > -vel y
value = 52

;============<CONTINUE?>==============
[Statedef 5500]
type = S
anim = 5300
velset = 0,0
ctrl = 0

[State 5500, Anim]
type = ChangeAnim
trigger1 = !Time
value = 5500

;=============<CHEAP K.O.>=============
[StateDef 5950]
type = S
moveType = H
physics = S
anim = 5950
velSet = 0,0

[State 5950, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA

[State 5950, PosSet]
type = PosSet
trigger1 = 1
y = 0

[State 5950, Assert: NoKOsnd]
type = AssertSpecial
trigger1 = 1
flag = NoKOsnd

[State 5950, StopSnd]
type = StopSnd
trigger1 = !Time && !Alive
channel = 0

[State 5950, KO Sound]
type = PlaySnd
trigger1 = AnimElem = 2 && !Alive
value = 11,1

[State 5950, Hitting the Floor Sound]
type = PlaySnd
trigger1 = AnimElem = 5
value = 5000,11
volume = 200

[State 5950, Hitting the Floor Explod]
type = Explod
trigger1 = AnimElem = 5
anim = 8102
sprpriority = -3
postype = P1
scale = 0.5,0.5
pauseMoveTime = -1
superMoveTime = -1
ownPal = 1

[State 5950, End]
type = ChangeState
trigger1= !AnimTime
value = ifElse(Alive, 5110, 5150)

;================<AIR HIT TRANSITION>=================
[Statedef 5035]
type = A
movetype = H
physics = N

[State 5035, ChangeAnim]
type = ChangeAnim
trigger1 = !Time
trigger1 = SelfAnimExist(5035)
trigger1 = Anim = [5000,5029]
value = 5035

[State 5035, VelAdd]
type = VelAdd
trigger1 = 1
y = GetHitVar(yAccel)

[State 5035, Recover]
type = ChangeState
triggerAll = !HitFall
trigger1 = HitOver
trigger2 = !AnimTime
trigger3 = vel y > 0 && pos y >= 10
trigger4 = !Time
trigger4 = Anim != 5035
value = 5040

[State 5035, Fall]
type = ChangeState
triggerAll = HitFall
trigger1 = HitOver
trigger2 = !AnimTime
trigger3 = vel y > 0 && pos y >= 10
trigger4 = !Time
trigger4 = Anim != 5035
value = 5050










































































































































































;====================<PARRY>====================
;Standing Parry
[StateDef 775]
type = S
physics = S
moveType = I
anim = 760
velSet = 0,0
ctrl = 0
sprPriority = 2
powerAdd = 78 * !var(20)
faceP2 = 1

[State 760, HitBy]
type = HitBy
trigger1 = 1
value = SCA,AT
time = 1

[State 760, Pause]
type = Pause
trigger1 = !Time
time = 15
moveTime = 15
endCmdBufTime = 15
pauseBg = 0

[State 760, Stop]
type = PosFreeze
trigger1 = 1
value = 1

[State 760, No Walking]
type = VarSet
trigger1 = 1
var(26) = 7

[State 760, Voice]
type = PlaySnd
trigger1= !Time
value = 0,15
channel = 0

[State 760, Parry Sound]
type = PlaySnd
trigger1 = !Time
value = 760,0

[State 760, Player Flash]
type = PalFX
trigger1 = !Time
add = 0,64,255
sinadd = 0,-64,-255,60
time = 15

[State 760, FX]
type = Explod
trigger1 = !Time
anim = 8360
sprPriority = 5
posType = P1
pos = ceil(15 * const(size.xScale)), ceil(-55 * const(size.yScale))
pauseMoveTime = -1
superMoveTime = -1
scale = 0.5,0.5
ownPal = 1

[State 760, saber FX]
type = Explod
trigger1 = animelem = 3
anim = 768
sprPriority = 5
posType = P1
pos = 8,-20
pauseMoveTime = -1
superMoveTime = -1
scale = .5,.5
ownPal = 1
ignorehitpause = 1
removetime = 10
removeongethit = 1

[State 760, EnvShake]
type = EnvShake
trigger1 = !Time
time = 0
ampl = 0

[State 760, End]
type = ChangeState
trigger1 = !AnimTime
value = 0
ctrl = 1

;Crouching Parry
[StateDef 776]
type = C
physics = C
moveType = I
anim = 761
velSet = 0,0
ctrl = 0
sprPriority = 2
powerAdd = 78 * !var(20)
faceP2 = 1

[State 761, HitBy]
type = HitBy
trigger1 = 1
value = SCA,AT
time = 1

[State 761, Pause]
type = Pause
trigger1 = !Time
time = 15
moveTime = 15
endCmdBufTime = 15
pauseBg = 0

[State 761, PosFreeze]
type = PosFreeze
trigger1 = 1
value = 1

[State 761, No Walk]
type = VarSet
trigger1 = 1
var(26) = 7

[State 761, Voice]
type = PlaySnd
trigger1 = !Time
value = 0,19
channel = 0

[State 761, Parry Sound]
type = PlaySnd
trigger1 = !Time
value = 760,0

[State 761, Player Flash]
type = PalFX
trigger1 = !Time
add = 0,64,255
sinAdd = 0,-64,-255,60
time = 15

[State 761, Parry FX]
type = Explod
trigger1 = !Time
anim = 8360
sprpriority = 5
postype = P1
pos = ceil(10 * const(size.xScale)), ceil(-37 * const(size.yScale))
pauseMovetime = -1
superMovetime = -1
scale = 0.5,0.5
ownpal = 1

[State 760, saber FX]
type = Explod
trigger1 = animelem = 2
anim = 768
sprPriority = 5
posType = P1
pos = 5,-5
pauseMoveTime = -1
superMoveTime = -1
scale = .5,.5
ownPal = 1
ignorehitpause = 1
removetime = 10
removeongethit = 1

[State 761, EnvShake]
type = EnvShake
trigger1 = !time
time = 0
ampl = 0

[State 761, End]
type = ChangeState
trigger1 = !AnimTime
value = 11
ctrl = 1


;Jumping Parry
[StateDef 777]
type = A
physics = N
moveType = I
anim = 762
ctrl = 0
sprPriority = 2
powerAdd = 78 * !var(20)
faceP2 = 1

[State 762, HitBy]
type = HitBy
trigger1 = 1
value = SCA,AT
time = 1

[State 762, Pause]
type = Pause
trigger1 = !Time
time = 15
moveTime = 15
endCmdBufTime = 15
pauseBg = 0

[State 762, PosFreeze]
type = PosFreeze
trigger1 = 1
value = 1

[State 762, Voice]
type = PlaySnd
trigger1 = !Time
value = 0,14
channel = 0

[State 762, Parry Sound]
type = PlaySnd
trigger1 = !Time
value = 760,0

[State 762, Player Flash]
type = PalFX
trigger1 = !Time
add = 0,64,255
sinadd = 0,-64,-255,60
time = 15

[State 762, Parry FX]
type = Explod
trigger1 = !Time
anim = 8360
sprPriority = 5
posType = P1
pos = ceil(20 * const(size.xScale)), ceil(-70 * const(size.yScale))
pauseMoveTime = -1
superMoveTime = -1
scale = 0.5,0.5
ownpal = 1

[State 760, saber FX]
type = Explod
trigger1 = animelem = 2
anim = 768
sprPriority = 5
posType = P1
pos = 15,-37
pauseMoveTime = -1
superMoveTime = -1
scale = .5,.5
ownPal = 1
ignorehitpause = 1
removetime = 10
removeongethit = 1

[State 762, EnvShake]
type = EnvShake
trigger1 = !Time
time = 0
ampl = 0

[State 762, End]
type = ChangeState
trigger1 = !AnimTime
value = 763
ctrl = 1


;=============<RUNNING - DASH>====================
;Dash
[Statedef 107]
type    = S
physics = N
anim = 100
ctrl = 0

[State 0, Explod]
type = Explod
trigger1 = animelem = 2
anim = 1021
pos = -60,-30
postype = p1
bindtime = -1
facing = 1
supermovetime = 9999
pausemovetime = 9999
removetime = -1
sprpriority = 5
removeongethit = 1
scale = 1,1
ID = 400
ownpal = 1

[State 0, Explod]
type = Explod
trigger1 = time = 0
anim = 7023
pos = 0,0
postype = p1
bindtime = 1
supermovetime = 9999
pausemovetime = 9999
removetime = -2
sprpriority = 5
removeongethit = 0
scale = .3,.3
ownpal = 1

[State 1, dust]
type = Explod
trigger1 = !time
anim = 7502
ID = 1056
pos = 10,1
postype = p1
supermove = 1
scale = .4,.30
removeongethit = 1
ownpal = -1
sprpriority = 5
pausemovetime = -1
ignorehitpause = 1

[State 1, dust]
type = Explod
trigger1 = timemod = 3,0
anim = 7502
ID = 1056
pos = -10,1
postype = p1
supermove = 1
scale = .2,.1
removeongethit = 1
ownpal = -1
sprpriority = 5
pausemovetime = -1
ignorehitpause = 1

[State 100, 1]
type = PlaySnd
trigger1 = Time = 1
value = 100,3

;[State 100, 9]
;type = MakeDust
;trigger1 = Time = 1
;pos = -25,-2
;spacing = 1

;[State 100, 10]
;type = MakeDust
;trigger1 = AnimElem = 1, >= 0
;pos = -15,-2

[State 100, 1]
type = AssertSpecial
trigger1 = Anim = 100
flag = NoWalk

[State 101, 1]
type = VelSet
trigger1 = 1
x = 8

[State 100, AnimTime]
type = ChangeState
trigger1 = 1;command = "holdup"
value = 41
ctrl = 0

[State 100, AnimTime]
type = ChangeState
trigger1 = command = "back"
value = 101
ctrl = 0

[State 100, No Walk During Run]
type = AssertSpecial
trigger1 = 1
flag = NoWalk

[State 100, 6]
type = ChangeState
trigger1 = time = 35
value = 101
ctrl = 1


;-------------
;WALKING
[StateDef 27]
type = S
physics = S
moveType = I
sprPriority = 0
ctrl=0


[State 0, PlaySnd]
type = PlaySnd
triggerall = anim = 20
trigger1 = animelem = 2
trigger2 = animelem = 8
value = S20,0
volume = 300
freqmul = 1
channel = 1

[State 0, PlaySnd]
type = PlaySnd
triggerall = anim = 21
trigger1 = animelem = 3
trigger2 = animelem = 6
value = S20,0
volume = 300
freqmul = 1
channel = 1

[State 20, VelSet]
type = VelSet
trigger1 = 1;command = "holdfwd"
x = const(velocity.walk.fwd.x)

[State 20, VelSet]
type = VelSet
trigger1 = 0;command = "holdback"
x = const(velocity.walk.back.x)

[State 20, ChangeAnim]
type = ChangeAnim
triggerAll = vel x > 0
trigger1 = Anim != 20 && Anim != 5
trigger2 = Anim = 5 && AnimElemTime(1) >= 1
value = 20

[State 20, ChangeAnim]
type = ChangeAnim
triggerAll = vel x < 0
trigger1 = Anim != 21 && Anim != 5
trigger2 = Anim = 5 && AnimElemTime(1) >= 1
value = 21


;-------------
;WALKING
[StateDef 28]
type = S
physics = S
moveType = I
sprPriority = 0
ctrl=0


[State 0, PlaySnd]
type = PlaySnd
triggerall = anim = 20
trigger1 = animelem = 2
trigger2 = animelem = 8
value = S20,0
volume = 300
freqmul = 1
channel = 1

[State 0, PlaySnd]
type = PlaySnd
triggerall = anim = 21
trigger1 = animelem = 3
trigger2 = animelem = 6
value = S20,0
volume = 300
freqmul = 1
channel = 1

[State 20, VelSet]
type = VelSet
trigger1 = 0;command = "holdfwd"
x = const(velocity.walk.fwd.x)

[State 20, VelSet]
type = VelSet
trigger1 = 1;command = "holdback"
x = const(velocity.walk.back.x)

[State 20, ChangeAnim]
type = ChangeAnim
triggerAll = vel x > 0
trigger1 = Anim != 20 && Anim != 5
trigger2 = Anim = 5 && AnimElemTime(1) >= 1
value = 20

[State 20, ChangeAnim]
type = ChangeAnim
triggerAll = vel x < 0
trigger1 = Anim != 21 && Anim != 5
trigger2 = Anim = 5 && AnimElemTime(1) >= 1
value = 21


;====================<JUMPING>====================
;Jumping

[StateDef 43]
type = S
physics = S
moveType = I
anim = 40
ctrl = 0
velSet = 0,0
sprPriority = 1
faceP2 = 1

[State 40, Remove Explod]
type = removeExplod
trigger1 = time = 0
ID = 400

[State 40, Direction]
type = VarSet
trigger1 = 1
sysvar(1) = 1;ifElse(!Time, 0, ifElse(command = "holdfwd", 1, ifElse(command = "holdback", -1, sysvar(1))))

[State 40, High Jump]
type = VarSet
trigger1 = 0;!Time
var(3) = ifElse(command = "highjump", 3, 0)

[State 40, High Jump]
type = VarSet
trigger1 = !Time && PrevStateNo = [100,109]
var(3) = 3

[State 40, Low Jump]
type = VarSet
trigger1 = (var(3) != [1,2]);command != "holdup" && (var(3) != [1,2])
var(3) = ifElse((var(3) = 3 && sysvar(1)), 2, 1)

[State 40, Jump Sound]
type = PlaySnd
trigger1 = !AnimTime
value = ifElse((var(3) = [2,3]), 41, 40), 0

[State 40, Dust Helper]
type = Helper
trigger1 = !AnimTime
helperType = Normal
stateNo = 8100
ID = 8100
name = "Jump Dust"
posType = P1
ownPal = 1

[State 40, Velocity: Normal Jump]
type = VelSet
trigger1 = !AnimTime
x = ifElse(!sysvar(1), const(velocity.jump.neu.x), ifElse(sysvar(1) = 1, const(velocity.jump.fwd.x), const(velocity.jump.back.x)))
y = const(velocity.jump.y)

[State 40, Velocity: Low Jump]
type = VelSet
trigger1 = !AnimTime && var(3) = 1
x = ifElse(!sysvar(1), const(velocity.jump.neu.x), ifElse(sysvar(1) = 1, const(velocity.jump.fwd.x), const(velocity.jump.back.x)))
y = 0.75 * const(velocity.jump.y)

[State 40, Velocity: Long Low Jump]
type = VelSet
trigger1 = !AnimTime && var(3) = 2
x = ifElse(!sysvar(1), const(velocity.jump.neu.x), ifElse(sysvar(1) = 1, const(velocity.runjump.fwd.x), const(velocity.runjump.back.x)))
y = 0.75 * const(velocity.jump.y)

[State 40, Velocity: Long Jump]
type = VelSet
trigger1 = !AnimTime && var(3) = 3
x = ifElse(!sysvar(1), const(velocity.jump.neu.x), ifElse(sysvar(1) = 1, const(velocity.runjump.fwd.x), const(velocity.runjump.back.x)))
y = ifElse(!sysvar(1), const(velocity.runjump.y), const(velocity.jump.y))

[State 40, End]
type = ChangeState
trigger1 = !AnimTime
value = 50
ctrl = 1
;====================<JUMPING>====================
;Jumping

[StateDef 41]
type = S
physics = S
moveType = I
anim = 40
ctrl = 0
velSet = 0,0
sprPriority = 1
faceP2 = 1

[State 40, Remove Explod]
type = removeExplod
trigger1 = time = 0
ID = 400

[State 40, Direction]
type = VarSet
trigger1 = 1
sysvar(1) = 1;ifElse(!Time, 0, ifElse(command = "holdfwd", 1, ifElse(command = "holdback", -1, sysvar(1))))

[State 40, High Jump]
type = VarSet
trigger1 = 0;!Time
var(3) = ifElse(command = "highjump", 3, 0)

[State 40, High Jump]
type = VarSet
trigger1 = !Time && PrevStateNo = [100,109]
var(3) = 3

[State 40, Low Jump]
type = VarSet
trigger1 = (var(3) != [1,2]);command != "holdup" && (var(3) != [1,2])
var(3) = ifElse((var(3) = 3 && sysvar(1)), 2, 1)

[State 40, Jump Sound]
type = PlaySnd
trigger1 = !AnimTime
value = ifElse((var(3) = [2,3]), 41, 40), 0

[State 40, Dust Helper]
type = Helper
trigger1 = !AnimTime
helperType = Normal
stateNo = 8100
ID = 8100
name = "Jump Dust"
posType = P1
ownPal = 1

[State 40, Velocity: Normal Jump]
type = VelSet
trigger1 = !AnimTime
x = ifElse(!sysvar(1), const(velocity.jump.neu.x), ifElse(sysvar(1) = 1, const(velocity.jump.fwd.x), const(velocity.jump.back.x)))
y = const(velocity.jump.y)

[State 40, Velocity: Low Jump]
type = VelSet
trigger1 = !AnimTime && var(3) = 1
x = ifElse(!sysvar(1), const(velocity.jump.neu.x), ifElse(sysvar(1) = 1, const(velocity.jump.fwd.x), const(velocity.jump.back.x)))
y = 0.75 * const(velocity.jump.y)

[State 40, Velocity: Long Low Jump]
type = VelSet
trigger1 = !AnimTime && var(3) = 2
x = ifElse(!sysvar(1), const(velocity.jump.neu.x), ifElse(sysvar(1) = 1, const(velocity.runjump.fwd.x), const(velocity.runjump.back.x)))
y = 0.75 * const(velocity.jump.y)

[State 40, Velocity: Long Jump]
type = VelSet
trigger1 = !AnimTime && var(3) = 3
x = ifElse(!sysvar(1), const(velocity.jump.neu.x), ifElse(sysvar(1) = 1, const(velocity.runjump.fwd.x), const(velocity.runjump.back.x)))
y = ifElse(!sysvar(1), const(velocity.runjump.y), const(velocity.jump.y))

[State 40, End]
type = ChangeState
trigger1 = !AnimTime
value = 50
ctrl = 1

;====================<JUMPING>====================
;Jumping

[StateDef 42]
type = S
physics = S
moveType = I
anim = 40
ctrl = 0
velSet = 0,0
sprPriority = 1
faceP2 = 1

[State 40, Remove Explod]
type = removeExplod
trigger1 = time = 0
ID = 400

[State 40, Direction]
type = VarSet
trigger1 = 1
sysvar(1) = -1;ifElse(!Time, 0, ifElse(command = "holdfwd", 1, ifElse(command = "holdback", -1, sysvar(1))))

[State 40, High Jump]
type = VarSet
trigger1 = 0;!Time
var(3) = ifElse(command = "highjump", 3, 0)

[State 40, High Jump]
type = VarSet
trigger1 = !Time && PrevStateNo = [100,109]
var(3) = 3

[State 40, Low Jump]
type = VarSet
trigger1 = (var(3) != [1,2]);command != "holdup" && (var(3) != [1,2])
var(3) = ifElse((var(3) = 3 && sysvar(1)), 2, 1)

[State 40, Jump Sound]
type = PlaySnd
trigger1 = !AnimTime
value = ifElse((var(3) = [2,3]), 41, 40), 0

[State 40, Dust Helper]
type = Helper
trigger1 = !AnimTime
helperType = Normal
stateNo = 8100
ID = 8100
name = "Jump Dust"
posType = P1
ownPal = 1

[State 40, Velocity: Normal Jump]
type = VelSet
trigger1 = !AnimTime
x = ifElse(!sysvar(1), const(velocity.jump.neu.x), ifElse(sysvar(1) = 1, const(velocity.jump.fwd.x), const(velocity.jump.back.x)))
y = const(velocity.jump.y)

[State 40, Velocity: Low Jump]
type = VelSet
trigger1 = !AnimTime && var(3) = 1
x = ifElse(!sysvar(1), const(velocity.jump.neu.x), ifElse(sysvar(1) = 1, const(velocity.jump.fwd.x), const(velocity.jump.back.x)))
y = 0.75 * const(velocity.jump.y)

[State 40, Velocity: Long Low Jump]
type = VelSet
trigger1 = !AnimTime && var(3) = 2
x = ifElse(!sysvar(1), const(velocity.jump.neu.x), ifElse(sysvar(1) = 1, const(velocity.runjump.fwd.x), const(velocity.runjump.back.x)))
y = 0.75 * const(velocity.jump.y)

[State 40, Velocity: Long Jump]
type = VelSet
trigger1 = !AnimTime && var(3) = 3
x = ifElse(!sysvar(1), const(velocity.jump.neu.x), ifElse(sysvar(1) = 1, const(velocity.runjump.fwd.x), const(velocity.runjump.back.x)))
y = ifElse(!sysvar(1), const(velocity.runjump.y), const(velocity.jump.y))

[State 40, End]
type = ChangeState
trigger1 = !AnimTime
value = 50
ctrl = 1

;====================<JUMPING>====================
;Jumping

[StateDef 10042]
type = S
physics = S
moveType = I
anim = 40
ctrl = 0
velSet = 0,0
sprPriority = 1
faceP2 = 1

[State 40, Remove Explod]
type = removeExplod
trigger1 = time = 0
ID = 400

[State 40, Direction]
type = VarSet
trigger1 = 1
sysvar(1) = -1;ifElse(!Time, 0, ifElse(command = "holdfwd", 1, ifElse(command = "holdback", -1, sysvar(1))))

[State 40, High Jump]
type = VarSet
trigger1 = 0;!Time
var(3) = ifElse(command = "highjump", 3, 0)

[State 40, High Jump]
type = VarSet
trigger1 = !Time && PrevStateNo = [100,109]
var(3) = 3

[State 40, Low Jump]
type = VarSet
trigger1 = (var(3) != [1,2]);command != "holdup" && (var(3) != [1,2])
var(3) = ifElse((var(3) = 3 && sysvar(1)), 2, 1)

[State 40, Jump Sound]
type = PlaySnd
trigger1 = !AnimTime
value = ifElse((var(3) = [2,3]), 41, 40), 0

[State 40, Dust Helper]
type = Helper
trigger1 = !AnimTime
helperType = Normal
stateNo = 8100
ID = 8100
name = "Jump Dust"
posType = P1
ownPal = 1

[State 40, Velocity: Normal Jump]
type = VelSet
trigger1 = !AnimTime
x = ifElse(!sysvar(1), const(velocity.jump.neu.x), ifElse(sysvar(1) = 1, const(velocity.jump.fwd.x), const(velocity.jump.back.x)))
y = const(velocity.jump.y)

[State 40, Velocity: Low Jump]
type = VelSet
trigger1 = !AnimTime && var(3) = 1
x = ifElse(!sysvar(1), const(velocity.jump.neu.x), ifElse(sysvar(1) = 1, const(velocity.jump.fwd.x), const(velocity.jump.back.x)))
y = 0.75 * const(velocity.jump.y)

[State 40, Velocity: Long Low Jump]
type = VelSet
trigger1 = !AnimTime && var(3) = 2
x = ifElse(!sysvar(1), const(velocity.jump.neu.x), ifElse(sysvar(1) = 1, const(velocity.runjump.fwd.x), const(velocity.runjump.back.x)))
y = 0.75 * const(velocity.jump.y)

[State 40, Velocity: Long Jump]
type = VelSet
trigger1 = !AnimTime && var(3) = 3
x = ifElse(!sysvar(1), const(velocity.jump.neu.x), ifElse(sysvar(1) = 1, const(velocity.runjump.fwd.x), const(velocity.runjump.back.x)))
y = ifElse(!sysvar(1), const(velocity.runjump.y), const(velocity.jump.y))

[State 40, End]
type = ChangeState
trigger1 = !AnimTime
value = 50
ctrl = 1
;---------------------------------------------------------------------------
; GUARD (start)
[Statedef 120]
type = U    ;Leave state type unchanged
physics = U ;Leave physics unchanged

[State 120, 1]
type = ChangeAnim
trigger1 = Time = 0
value = 120 + (statetype = C) + (statetype = A)*2

[State 120, 2]
type = StateTypeSet
trigger1 = Time = 0 && statetype = S
physics = S

[State 120, 3]
type = StateTypeSet
trigger1 = Time = 0 && statetype = C
physics = C

[State 120, 4]
type = StateTypeSet
trigger1 = Time = 0 && statetype = A
physics = A

[State 120, Hi to Lo]
type = StateTypeSet
trigger1 = statetype = S && command = "holddown"
statetype = C
physics = C

[State 120, Lo to Hi]
type = StateTypeSet
trigger1 = statetype = C && command != "holddown"
statetype = S
physics = S

[State 120, 5]
type = ChangeState
trigger1 = AnimTime = 0
value = 130 + (statetype = C) + (statetype = A)*2

[State 120, Stop Guarding]
type = ChangeState
trigger1 = command != "holdback"
trigger2 = !inguarddist
value = 140

;---------------------------------------------------------------------------
; STAND GUARD (guarding)
[Statedef 130]
type    = S
physics = S
ctrl=ifelse(var(54)>0,0,1)

[state 130,1]
type =turn
trigger1 = var(54)
trigger1 = p2bodydist x<-30


[State 130, 1]
type = ChangeAnim
trigger1 = Anim != 130
value = 130

[state 130,1]
type = changestate
triggerall = !IsHelper
triggerall = var(54)>0
triggerall = Roundstate = 2 && Alive
triggerall=statetype!=A
triggerall=Var(55)<100000
triggerall=inguarddist||helper(218),inguarddist
triggerall=(enemynear(helper(218),Var(36)),MoveType != A)||(var(38)<=0 || var(38) !=p2stateno)
triggerall=(enemynear(helper(218),Var(36)),MoveType != A)||(var(39)<=0 || var(39) !=p2stateno)
trigger1=enemynear(helper(218),Var(36)),statetype !=A
trigger2=enemynear(helper(218),Var(36)),movetype !=A
value = 131

[state 130,1]
type = changestate
Trigger1 = var(54) <= 0
trigger1 = command = "holdback"
trigger1 = command = "holddown"
value = 131

[State 130, Stop Guarding]
type = ChangeState
Trigger1 = var(54) <= 0
trigger1 = command != "holdback"
Trigger2 = var(54) <= 0
trigger2 = !inguarddist
Trigger3 = var(54)>0
trigger3 = inguarddist=0 && helper(218),inguarddist=0
trigger3=helper(218),var(15)-((ceil(helper(218),var(15)/100)-ifelse(helper(218),var(15)-(ceil(helper(218),var(15)/100)*100)<0,1,0))*100)<=0||var(54)<0
value = 140

;---------------------------------------------------------------------------
; CROUCH GUARD (guarding)
[Statedef 131]
type    = C
physics = C
ctrl=ifelse(var(54)>0,0,1)


[state 130,1]
type =turn
trigger1 = var(54)
trigger1 = p2bodydist x<-30

[State 131, 1]
type = ChangeAnim
trigger1 = Anim != 131
value = 131


[State 10:          AI Guarding]
type       = ChangeState
triggerall = !IsHelper
triggerall = var(54)>0
triggerall = RoundState = 2 && Alive
triggerall=statetype !=A
triggerall=Var(55)<100000
triggerall=inguarddist || helper(218),inguarddist
trigger1=enemynear(helper(218),Var(36)),MoveType = A
trigger1=enemynear(helper(218),Var(36)),statetype=A
trigger2=enemynear(helper(218),Var(36)),MoveType = A
trigger2=(var(39)>0 && var(39)=p2stateno)||(var(38)>0 && var(38)=p2stateno)
value      = 130

[state 130,]
type = changestate
Trigger1 = var(54) <= 0
trigger1 = command="holdback"
trigger1 = command != "holddown"
value = 130

[State 131, Stop Guarding]
type = ChangeState
triggerall = var(54) !=0
trigger1 = inguarddist=0 && helper(218),inguarddist=0
value = 130
ctrl=0
[State 131, Stop Guarding]
type = ChangeState
triggerall = var(54)<=0
trigger1 = command != "holdback"
trigger2 = !inguarddist
value = 140

;---------------------------------------------------------------------------
; AIR GUARD (guarding)
[Statedef 132]
type    = A
physics = N
ctrl=ifelse(var(54)>0,0,1)

[State 132, 1]
type = ChangeAnim
trigger1 = Anim != 132
value = 132

[State 132, 2]
type = VelAdd
trigger1 = 1
y = Const(movement.yaccel)

[State 132, 3]
type = VarSet
trigger1 = 1
sysvar(0) = (pos y >= 0) && (vel y > 0)

[State 132, 4]
type = VelSet
trigger1 = sysvar(0)
y = 0

[State 132, 5]
type = PosSet
trigger1 = sysvar(0)
y = 0

[State 132, 6]
type = ChangeState
trigger1 = sysvar(0)&&var(54)<=0
trigger1 = command != "holdback"
value = 52

[State 132, 7]
type = ChangeState
trigger1 = sysvar(0)
value = 130

[State 132, Stop Guarding]
type = ChangeState
Trigger1 = var(54) <= 0
trigger1 = command != "holdback"
trigger2 = (inguarddist=0 && var(54)<=0)|| (var(54)>0&&inguarddist=0 && helper(218),inguarddist=0)
value = 140

;---------------------------------------------------------------------------
; GUARD (end)
[Statedef 140]
type = U    ;Leave state type unchanged
physics = U ;Leave physics unchanged
ctrl = 1

[State 140, 1]
type = ChangeAnim
trigger1 = Time = 0
value = 140 + (statetype = C) + (statetype = A)*2

[State 140, 2]
type = StateTypeSet
trigger1 = Time = 0 && statetype = S
physics = S

[State 140, 3]
type = StateTypeSet
trigger1 = Time = 0 && statetype = C
physics = C

[State 140, 4]
type = StateTypeSet
trigger1 = Time = 0 && statetype = A
physics = A

[State 100:          AI Guarding]
type = StateTypeSet
triggerall = !IsHelper
triggerall = var(54) !=0
triggerall=statetype =C
trigger1=enemynear(helper(218),Var(36)),MoveType = A
trigger1=enemynear(helper(218),Var(36)),statetype=A
trigger2=enemynear(helper(218),Var(36)),MoveType = A
trigger2=(var(39)>0 && var(39)=p2stateno)||(var(38)>0 && var(38)=p2stateno)
trigger4=Var(55)>=100000
statetype = S
physics = S
[State 100:          AI Guarding]
type = StateTypeSet
triggerall = !IsHelper
triggerall = var(54) !=0
triggerall=statetype=S
triggerall=Var(55)<100000
triggerall=(enemynear(helper(218),Var(36)),MoveType != A)||(var(38)<=0 || var(38) !=p2stateno)
triggerall=(enemynear(helper(218),Var(36)),MoveType != A)||(var(39)<=0 || var(39) !=p2stateno)
trigger1=enemynear(helper(218),Var(36)),statetype !=A
trigger2=enemynear(helper(218),Var(36)),movetype !=A
statetype = C
physics = C
[State 152, Hi to Lo]
type = StateTypeSet
triggerall = var(54)=0
trigger1 = statetype = S && command = "holddown"
statetype = C
physics = C

[State 152, Lo to Hi]
type = StateTypeSet
triggerall = var(54)=0
trigger1 = statetype = C && command != "holddown"
statetype = S
physics = S

;[State 140, 5] ;Implemented within engine
;type = ChangeState
;trigger1 = AnimTime = 0
;value = (statetype = C)*11 + (statetype = A)*51

;---------------------------------------------------------------------------
; SGUARDHIT (shaking)
[Statedef 150]
type    = S
movetype= H
physics = N
velset = 0,0

[State 150, 1]
type = ChangeAnim
trigger1 = 1
value = 150

[State 150, 2]
type = ChangeState
triggerall = var(54) =0
trigger1 = HitShakeOver
value = 151 + 2*(command = "holddown")

[State 100:          AI Guarding]
type       = ChangeState
triggerall = !IsHelper
triggerall = var(54) !=0
triggerall=HitShakeOver;||(time>=15 && var(20) = [1,7])
trigger1=enemynear(helper(218),Var(36)),MoveType = A
trigger1=enemynear(helper(218),Var(36)),statetype=A
trigger2=enemynear(helper(218),Var(36)),MoveType = A
trigger2=(var(39)>0 && var(39)=p2stateno)||(var(38)>0 && var(38)=p2stateno)
trigger4=Var(55)>=100000
value      = 151
[State 100:          AI Guarding]
type       = ChangeState
triggerall = !IsHelper
triggerall = var(54) !=0
triggerall=HitShakeOver;||(time>=15 && var(20) = [1,7])
triggerall=Var(55)<100000
triggerall=(enemynear(helper(218),Var(36)),MoveType != A)||(var(38)<=0 || var(38) !=p2stateno)
triggerall=(enemynear(helper(218),Var(36)),MoveType != A)||(var(39)<=0 || var(39) !=p2stateno)
trigger1=enemynear(helper(218),Var(36)),statetype !=A
trigger2=enemynear(helper(218),Var(36)),movetype !=A
value      = 153
[State 100:          AI Guarding]
type = StateTypeSet
triggerall = !IsHelper
triggerall = var(54) !=0
triggerall=statetype =C
trigger1=enemynear(helper(218),Var(36)),MoveType = A
trigger1=enemynear(helper(218),Var(36)),statetype=A
trigger2=enemynear(helper(218),Var(36)),MoveType = A
trigger2=(var(39)>0 && var(39)=p2stateno)||(var(38)>0 && var(38)=p2stateno)
trigger4=Var(55)>=100000
statetype = S
physics = S
[State 100:          AI Guarding]
type = StateTypeSet
triggerall = !IsHelper
triggerall = var(54) !=0
triggerall=statetype=S
triggerall=Var(55)<100000
triggerall=(enemynear(helper(218),Var(36)),MoveType != A)||(var(38)<=0 || var(38) !=p2stateno)
triggerall=(enemynear(helper(218),Var(36)),MoveType != A)||(var(39)<=0 || var(39) !=p2stateno)
trigger1=enemynear(helper(218),Var(36)),statetype !=A
trigger2=enemynear(helper(218),Var(36)),movetype !=A
statetype = C
physics = C

[State 152, Hi to Lo]
type = StateTypeSet
triggerall = var(54)=0
trigger1 = statetype = S && command = "holddown"
statetype = C
physics = C

[State 152, Lo to Hi]
type = StateTypeSet
triggerall = var(54)=0
trigger1 = statetype = C && command != "holddown"
statetype = S
physics = S

[State 150, 3]
type = ForceFeedback
trigger1 = time = 0
waveform = square
time = 3

;---------------------------------------------------------------------------
; SGUARDHIT2 (knocked back)
[Statedef 151]
type    = S
movetype= H
physics = S
anim = 150

[State Protection]
type = NotHitBy
trigger1 = 0;HitOver || Time = GetHitVar(ctrltime)
value = , AT
time = 3
persistent = 0
ignorehitpause = 1

[State 151, 1]
type = HitVelSet
trigger1 = Time = 0
x = 1

[State 151, 2]
type = VelSet
trigger1 = Time = GetHitVar(slidetime)
trigger2 = HitOver
x = 0

[State 151, 3]
type = CtrlSet
trigger1 = Time = GetHitVar(ctrltime)
value = 1



[State 100:          AI Guarding]
type = StateTypeSet
triggerall = !IsHelper
triggerall = var(54) !=0
triggerall=statetype =C
trigger1=enemynear(helper(218),Var(36)),MoveType = A
trigger1=enemynear(helper(218),Var(36)),statetype=A
trigger2=enemynear(helper(218),Var(36)),MoveType = A
trigger2=(var(39)>0 && var(39)=p2stateno)||(var(38)>0 && var(38)=p2stateno)
trigger4=Var(55)>=100000
statetype = S
physics = S
[State 100:          AI Guarding]
type = StateTypeSet
triggerall = !IsHelper
triggerall = var(54) !=0
triggerall=statetype=S
triggerall=Var(55)<100000
triggerall=(enemynear(helper(218),Var(36)),MoveType != A)||(var(38)<=0 || var(38) !=p2stateno)
triggerall=(enemynear(helper(218),Var(36)),MoveType != A)||(var(39)<=0 || var(39) !=p2stateno)
trigger1=enemynear(helper(218),Var(36)),statetype !=A
trigger2=enemynear(helper(218),Var(36)),movetype !=A
statetype = C
physics = C

[State 151, Hi to Lo]
type = StateTypeSet
triggerall = var(54)=0
trigger1 = statetype = S && command = "holddown"
statetype = C
physics = C

[State 151, Lo to Hi]
type = StateTypeSet
triggerall = var(54)=0
trigger1 = statetype = C && command != "holddown"
statetype = S
physics = S

[State 151, 4]
type = ChangeState
trigger1 = HitOver
value = 130
ctrl = 1

;---------------------------------------------------------------------------
; CGUARDHIT (shaking)
[Statedef 152]
type    = C
movetype= H
physics = N
velset = 0,0

[State 152, 1]
type = ChangeAnim
trigger1 = 1
value = 151


[State 150, 2]
type = ChangeState
triggerall = var(54) =0
trigger1 = HitShakeOver
value = 151 + 2*(command = "holddown")

[State 100:          AI Guarding]
type       = ChangeState
triggerall = !IsHelper
triggerall = var(54) !=0
triggerall=HitShakeOver;||(time>=15 && var(20) = [1,7])
trigger1=enemynear(helper(218),Var(36)),MoveType = A
trigger1=enemynear(helper(218),Var(36)),statetype=A
trigger2=enemynear(helper(218),Var(36)),MoveType = A
trigger2=(var(39)>0 && var(39)=p2stateno)||(var(38)>0 && var(38)=p2stateno)
trigger4=Var(55)>=100000
value      = 151
[State 100:          AI Guarding]
type       = ChangeState
triggerall = !IsHelper
triggerall = var(54) !=0
triggerall=HitShakeOver;||(time>=15 && var(20) = [1,7])
triggerall=Var(55)<100000
triggerall=(enemynear(helper(218),Var(36)),MoveType != A)||(var(38)<=0 || var(38) !=p2stateno)
triggerall=(enemynear(helper(218),Var(36)),MoveType != A)||(var(39)<=0 || var(39) !=p2stateno)
trigger1=enemynear(helper(218),Var(36)),statetype !=A
trigger2=enemynear(helper(218),Var(36)),movetype !=A
value      = 153
[State 100:          AI Guarding]
type = StateTypeSet
triggerall = !IsHelper
triggerall = var(54) !=0
triggerall=statetype =C
trigger1=enemynear(helper(218),Var(36)),MoveType = A
trigger1=enemynear(helper(218),Var(36)),statetype=A
trigger2=enemynear(helper(218),Var(36)),MoveType = A
trigger2=(var(39)>0 && var(39)=p2stateno)||(var(38)>0 && var(38)=p2stateno)
trigger4=Var(55)>=100000
statetype = S
physics = S
[State 100:          AI Guarding]
type = StateTypeSet
triggerall = !IsHelper
triggerall = var(54) !=0
triggerall=statetype=S
triggerall=Var(55)<100000
triggerall=(enemynear(helper(218),Var(36)),MoveType != A)||(var(38)<=0 || var(38) !=p2stateno)
triggerall=(enemynear(helper(218),Var(36)),MoveType != A)||(var(39)<=0 || var(39) !=p2stateno)
trigger1=enemynear(helper(218),Var(36)),statetype !=A
trigger2=enemynear(helper(218),Var(36)),movetype !=A
statetype = C
physics = C

[State 152, Hi to Lo]
type = StateTypeSet
triggerall = var(54)=0
trigger1 = statetype = S && command = "holddown"
statetype = C
physics = C

[State 152, Lo to Hi]
type = StateTypeSet
triggerall = var(54)=0
trigger1 = statetype = C && command != "holddown"
statetype = S
physics = S

[State 152, 4]
type = ForceFeedback
trigger1 = time = 0
waveform = square
time = 4

;---------------------------------------------------------------------------
; CGUARDHIT2 (knocked back)
[Statedef 153]
type    = C
movetype= H
physics = C
anim = 151

[State Protection]
type = NotHitBy
trigger1 = 0;HitOver || Time = GetHitVar(ctrltime)
value = , AT
time = 3
persistent = 0
ignorehitpause = 1

[State 153, 1]
type = HitVelSet
trigger1 = Time = 0
x = 1

[State 153, 2]
type = VelSet
trigger1 = Time = GetHitVar(slidetime)
trigger2 = HitOver
x = 0

[State 153, 3]
type = CtrlSet
trigger1 = Time = GetHitVar(ctrltime)
value = 1



[State 100:          AI Guarding]
type = StateTypeSet
triggerall = !IsHelper
triggerall = var(54) !=0
triggerall=statetype =C
trigger1=enemynear(helper(218),Var(36)),MoveType = A
trigger1=enemynear(helper(218),Var(36)),statetype=A
trigger2=enemynear(helper(218),Var(36)),MoveType = A
trigger2=(var(39)>0 && var(39)=p2stateno)||(var(38)>0 && var(38)=p2stateno)
trigger4=Var(55)>=100000
statetype = S
physics = S
[State 100:          AI Guarding]
type = StateTypeSet
triggerall = !IsHelper
triggerall = var(54) !=0
triggerall=statetype=S
triggerall=Var(55)<100000
triggerall=(enemynear(helper(218),Var(36)),MoveType != A)||(var(38)<=0 || var(38) !=p2stateno)
triggerall=(enemynear(helper(218),Var(36)),MoveType != A)||(var(39)<=0 || var(39) !=p2stateno)
trigger1=enemynear(helper(218),Var(36)),statetype !=A
trigger2=enemynear(helper(218),Var(36)),movetype !=A
statetype = C
physics = C

[State 151, Hi to Lo]
type = StateTypeSet
triggerall = var(54)=0
trigger1 = statetype = S && command = "holddown"
statetype = C
physics = C

[State 151, Lo to Hi]
type = StateTypeSet
triggerall = var(54)=0
trigger1 = statetype = C && command != "holddown"
statetype = S
physics = S

[State 153, 4]
type = ChangeState
trigger1 = HitOver
value = 131
ctrl = 1

;---------------------------------------------------------------------------
; AGUARDHIT (shaking)
[Statedef 154]
type    = A
movetype= H
physics = N
velset = 0,0

[State 154, 1]
type = ChangeAnim
trigger1 = 1
value = 152

[State 154, 2]
type = ChangeState
trigger1 = HitShakeOver
value = 155 ;AGUARDHIT2

[State 154, 3]
type = ForceFeedback
trigger1 = time = 0
waveform = square
time = 4

;---------------------------------------------------------------------------
; AGUARDHIT2 (knocked away)
[Statedef 155]
type    = A
movetype= H
physics = N
anim = 152

[State Protection]
type = NotHitBy
trigger1 = 0;HitOver || Time = GetHitVar(ctrltime)
value = , AT
time = 3
persistent = 0
ignorehitpause = 1

[State 155, 1]
type = HitVelSet
trigger1 = Time = 0
x = 1
y = 1

[State 155, 2]
type = VelAdd
trigger1 = 1
y = Const(movement.yaccel)

[State 155, 3]
type = CtrlSet
trigger1 = Time = GetHitVar(ctrltime)
value = 1

[State 155, 4]
type = VarSet
trigger1 = 1
sysvar(0) = (pos y >= 0) && (vel y > 0)

[State 155, 5]
type = VelSet
trigger1 = sysvar(0)
y = 0

[State 155, 6]
type = PosSet
trigger1 = sysvar(0)
y = 0

[State 155, 6]
type = ChangeState
trigger1 = sysvar(0)
trigger1 = command = "holdback"||var(54)
trigger1 = inguarddist
value = 130

[State 155, 7]
type = ChangeState
trigger1 = sysvar(0)
value = 52


;---------------------------------------------------------------------------
; States that are always executed (use statedef -2)
;---------------------------------------------------------------------------
[Statedef -2]

;========================<SOULGENMU STATES>=====================================
[State -2, V-ism]
type = AttackMulSet
trigger1 = 1
ignorehitpause = 1
value = 0.8

[State -2, AfterImageTime]
type = AfterImageTime
trigger1 = Var(2) > 0
ignorehitpause = 1
time = 2

[State -2, NoJuggle]
type = AssertSpecial
trigger1 = Var(2) > 0
ignorehitpause = 1
flag = NoJuggleCheck

[State -2, AttackMulSet]
type = AttackMulSet
trigger1 = Var(2) > 0
ignorehitpause = 1
value = 0.4

[State -2, NoGuard]
type = AssertSpecial
trigger1 = Var(2) > 0
ignorehitpause = 1
flag = NoStandGuard
flag2 = NoCrouchGuard
flag3 = NoAirGuard

[State -2, PowerSet]
type = PowerSet
triggerall = Var(2) > 0
triggerall = StateNo != 300
triggerall = StateNo != 310
trigger1 = NumHelper(320) = 0
trigger2 = StateNo >= 2000
trigger3 = MoveType = H
trigger4 = RoundState > 2
ignorehitpause = 1
value = Power - 1000

[State -2, VarSet]
type = VarSet
triggerall = Var(2) > 0
triggerall = StateNo != 300
triggerall = StateNo != 310
trigger1 = NumHelper(320) = 0
trigger2 = StateNo >= 2000
trigger3 = MoveType = H
trigger4 = RoundState > 2
trigger5 = Power <= 0
ignorehitpause = 1
var(2) = 0

;[State -2, aura 1]
;type = Explod
;triggerall = Var(2) > 0
;trigger1 = random > 750
;anim = 6011
;ID = 6012
;pos = -15+(random%5),-4+(random%5)
;postype = p1
;facing = 1
;vfacing = 1
;bindtime = -1
;random = 10,30
;supermove = 1
;scale = .4,.4
;sprpriority = ifelse(random<500,-3,3)
;ownpal = 1
;pausemovetime   = 1000

;[State -2, aura 1]
;type = Explod
;triggerall = Var(2) > 0
;trigger1 = random > 750
;anim = 6011
;ID = 6012
;pos = 15+(random%5),-4+(random%5)
;postype = p1
;facing = -1
;vfacing = 1
;bindtime = -1
;random = 10,30
;supermove = 1
;scale = .4,.4
;sprpriority = ifelse(random<500,-3,3)
;ownpal = 1

;[State -2, aura 1]
;type = Explod
;triggerall = Var(2) > 0
;trigger1 = random > 750
;anim = 6012
;ID = 6012
;pos = -6+(random%5),-14+(random%5)
;postype = p1
;facing = 1
;vfacing = 1
;bindtime = -1
;random = 10,30
;supermove = 1
;scale = .4,.4
;sprpriority = ifelse(random<500,-3,3)
;ownpal = 1
;pausemovetime   = 1000

;[State -2, aura 1]
;type = Explod
;triggerall = Var(2) > 0
;trigger1 = random > 750
;anim = 6012
;ID = 6012
;pos = 6+(random%5),-14+(random%5)
;postype = p1
;facing = -1
;vfacing = 1
;bindtime = -1
;random = 10,30
;supermove = 1
;scale = .4,.4
;sprpriority = ifelse(random<500,-3,3)
;ownpal = 1

;[State -2, aura 3]
;type = Explod
;triggerall = Var(2) > 0
;trigger1 = random > 700
;anim = 6010
;ID = 6012
;pos = 0+(random%5),-27+(random%5)
;postype = p1
;facing = -1
;vfacing = 1
;bindtime = -1
;random = 10,30
;supermove = 1
;scale = .4,.4
;sprpriority = ifelse(random<500,-3,3)
;ownpal = 1

;[State -2, remove aura]
;type = removeExplod
;trigger1 = Var(2) = 0
;ID = 6012

[State 624, saber]
type = removeexplod
trigger1 = Var(2) = 0
ID = 6000

[State 624, saber]
type = removeexplod
trigger1 = Var(2) = 0
ID = 6001

[State 624, saber]
type = removeexplod
trigger1 = Var(2) = 0
ID = 6002

[State 624, saber]
type = removeexplod
trigger1 = Var(2) = 0
ID = 6003

[State 624, saber]
type = removeexplod
trigger1 = Var(2) = 0
ID = 6004

[State 624, saber]
type = removeexplod
trigger1 = Var(2) = 0
ID = 6005

[State 624, saber]
type = removeexplod
trigger1 = Var(2) = 0
ID = 6006

[State 624, saber]
type = removeexplod
trigger1 = Var(2) = 0
ID = 6007

;========================<VIRUS ZERO ACT>=======================================
[State -2, Nightmare Zero]
type = helper
trigger1 = palno = 12
trigger1 = !numhelper(6010)
helpertype = normal
stateno = 6010
ID = 6010
name = "Shadow FX"
postype = p1
supermovetime = 65535
ownpal = 1

[State 0, Trans]
type = Trans
triggerall = palno = 12
trigger1 = 1
trans = add
ignorehitpause = 1

[State -2, Nightmare Zero]
type = sprpriority
trigger1 = palno = 12
value = -1

;========================<OMEGA ZERO ACT>=======================================
;Aura Shadow
[State -2, Helper]
type = Helper
triggerall = palno = 11
triggerall = Alive
triggerall = Life > 0
triggerall = NumHelper(9999) = 0
trigger1 = RoundState > 0
trigger1 = RoundState < 3
trigger1 = StateNo != 180
trigger1 = StateNo != 190
trigger2 = StateNo = 190
trigger2 = Anim = 191
trigger2 = AnimElem = 9
helpertype = normal
name = "Aura Shadow"
pausemovetime = 1000000000
supermovetime = 1000000000
id = 9999
pos = 0,0
postype = p1
stateno = 9999
keyctrl = 0
ownpal = 1

;=========================<BUSTER CHARGE VARS and FX>===========================
; Charged Z-Buster
[State -2, State]
type = ChangeState
triggerall = Var(40) = 10 && var(54)<=0
triggerall = NumHelper(1050) > 0
triggerall = Helper(1050), Anim = 1050
triggerall = command != "holda"
trigger1 = StateType != A
trigger1 = ctrl
trigger2 = Var(27) = 1
trigger3 = StateNo = 52
value = 1001

[State -2, State]
type = ChangeState
triggerall = Var(40) = 10 && var(54)<=0
triggerall = NumHelper(1050) > 0
triggerall = Helper(1050), Anim = 1051
triggerall = command != "holda"
trigger1 = StateType != A
trigger1 = ctrl
trigger2 = Var(27) = 1
trigger3 = StateNo = 52
value = 1002

[State -2, State]
type = ChangeState
triggerall = Var(40) = 10 && var(54)<=0
triggerall = NumHelper(1050) > 0
triggerall = Helper(1050), Anim = 1050
triggerall = command != "holda"
trigger1 = StateType = A
trigger1 = ctrl
trigger2 = Var(27) = 4
value = 1011

[State -2, State]
type = ChangeState
triggerall = Var(40) = 10 && var(54)<=0
triggerall = NumHelper(1050) > 0
triggerall = Helper(1050), Anim = 1051
triggerall = command != "holda"
trigger1 = StateType = A
trigger1 = ctrl
trigger2 = Var(27) = 4
value = 1012

; Z-Sabre Slash
[State -2, State]
type = ChangeState
triggerall = Var(40) = 10 && var(54)<=0
triggerall = NumHelper(1051) > 0
triggerall = Helper(1051), Anim = 1051
triggerall = command != "holdz"
trigger1 = StateType != A
trigger1 = ctrl
trigger2 = Var(27) = 1
trigger3 = StateNo = 52
value = 1021

[State -2, State]
type = ChangeState
triggerall = Var(40) = 10 && var(54)<=0
triggerall = NumHelper(1051) > 0
triggerall = Helper(1051), Anim = 1051
triggerall = command != "holdz"
trigger1 = StateType = A
trigger1 = ctrl
trigger2 = Var(27) = 4
value = 1031

[State -2, Reset]
type = VarSet
triggerall = Var(40) = 10 
trigger1 = Command != "holda"&& var(54)<=0
trigger1 = Command != "holdz"&& var(54)<=0
trigger2 = NumHelper(1050) > 0
trigger3 = NumHelper(1051) > 0
trigger4 = NumHelper(1052) > 0
trigger5 = StateNo > 2000
trigger6=var(54) && ((stateno=[1000,1002])||(stateno=[1010,1012])||(stateno=630))
var(18) = 0

[State -2, Charge Z]
type = VarAdd
triggerall = Var(40) = 10 
triggerall = TimeMod = 30,10
triggerall = StateNo < 2000
triggerall = NumHelper(1050) = 0
triggerall = NumHelper(1051) = 0
triggerall = NumHelper(1052) = 0
trigger1 = Command = "holda"&& var(54)<=0
trigger2 = Command = "holdz"&& var(54)<=0
trigger3=var(54) && ((p2movetype=H && p2stateno>200)||partner,life>0||var(54)-((ceil(var(54)/100)-ifelse(var(54)-(ceil(var(54)/100)*100)<0,1,0))*100)>=33)
var(18) = 1

[State -2, Helper]
type = Helper
triggerall = Var(40) = 10 
triggerall = NumHelper(1050) = 0
triggerall = NumHelper(1051) = 0
triggerall = NumHelper(1052) = 0
triggerall = Var(18) = 3
trigger1 = Command = "holda"&& var(54)<=0
trigger2=var(54) && ((p2movetype=H && p2stateno>200)||partner,life>0||var(54)-((ceil(var(54)/100)-ifelse(var(54)-(ceil(var(54)/100)*100)<0,1,0))*100)>=33)
helpertype = normal
name = "Z-Charge"
id = 1050
facing = 1
pos = 0,-50
postype = p1
stateno = 1050
keyctrl = 0
ownpal = 1
size.xscale = .5
size.yscale = .5

[State -2, Helper]
type = Helper
triggerall = Var(40) = 10 
triggerall = NumHelper(1050) = 0
triggerall = NumHelper(1051) = 0
triggerall = NumHelper(1052) = 0
triggerall = Var(18) = 3
trigger1 = Command = "holdz"&& var(54)<=0
helpertype = normal
name = "Z-Charge"
id = 1051
facing = 1
pos = 0,-50
postype = p1
stateno = 1050
keyctrl = 0
ownpal = 1
size.xscale = .5
size.yscale = .5

[State -2, 1st Flash]
type = PalFX
triggerall = Var(40) = 10
triggerall = TimeMod = 4,0
trigger1 = NumHelper(1050) > 0
trigger1 = Helper(1050), Anim = 1050
trigger2 = NumHelper(1051) > 0
trigger2 = Helper(1051), Anim = 1050
trigger3 = NumHelper(1052) > 0
trigger3 = Helper(1052), Anim = 1050
trigger4 = NumHelper(2050) > 0
trigger4 = Helper(2050), Anim = 1050
time = 2
add = 0,100,50
mul = 20,120,24
sinadd = 85,110,55,15
invertall = 0
color = 0

[State -2, 2nd Flash]
type = PalFX
triggerall = Var(40) = 10
triggerall = TimeMod = 4,0
trigger1 = NumHelper(1050) > 0
trigger1 = Helper(1050), Anim = 1051
trigger2 = NumHelper(1051) > 0
trigger2 = Helper(1051), Anim = 1051
trigger3 = NumHelper(1052) > 0
trigger3 = Helper(1052), Anim = 1051
trigger4 = NumHelper(2050) > 0
trigger4 = Helper(2050), Anim = 1051
time = 2
add = 240,50,0
mul = 250,224,120
sinadd = 110,55,85,10
invertall = 0
color = 0

;========================<CUSTOM COMBO>=====================================
[State -2, Original Combo End]
type=varset
trigger1= var(20)<0
trigger2= movetype=H
trigger3= roundstate!=2
var(20)=0
ignorehitpause=1

[State -2, Original Combo Time]
type=varadd
trigger1= var(20)>0
var(20)=-1
ignorehitpause=1

[State -2, Throws Disallowed]
type=varset
trigger1= 1 && var(54)=0
var(38)= 0

[State -2, Throws Disallowed]
type=varset
triggerall= var(54)=0
trigger1= (enemynear,stateno=[150,155])
trigger2= (enemynear,movetype=H && enemynear,statetype!=A) && !var(20)
trigger3= (enemynear,stateno=[5020,5040]) && !(enemynear,hitfall)
trigger4= ((enemynear,stateno=0) || (enemynear,stateno=52)) && (enemynear,prevstateno=[5000,5040]) && ((enemynear,time<=0) || !(enemynear,ctrl))
trigger5= (enemynear,stateno=0) && (enemynear,prevstateno=52) && ((enemynear,time<=0) || !(enemynear,ctrl))
trigger6= (enemynear,stateno=40) && (enemynear,time>=1 || enemynear,prevstateno=0 || enemynear,prevstateno=52)
var(38)= 1

[State -2, attackvarbyhits]
type=varset
trigger1= numenemy
fvar(10)= ifelse(enemynear,gethitvar(hitcount)<3, 24, ifelse(enemynear,gethitvar(hitcount)>=24, 2, 26-enemynear,gethitvar(hitcount)))/24.0
ignorehitpause=1

[State -2, attackvarbyhits]
type=varset
trigger1= numenemy && var(20)
fvar(10)= .72 * (10-ifelse(enemynear,gethitvar(hitcount)>=9, 9, enemynear,gethitvar(hitcount))) / 10.0
ignorehitpause=1

[State -2, attackvarbyhitsreset]
type=varset
trigger1= numenemy
trigger1= (enemynear,movetype!=H)
fvar(10)= ifelse(var(20), .72, 1)
ignorehitpause=1

[State -2, dampener var]
type=varset
trigger1=numenemy
fvar(12)= fvar(10) + (fvar(13)*!var(20)) + (var(29)*.2)
ignorehitpause=1

[State -2, dampener]
type=attackmulset
trigger1= 1
value=fvar(12) + .5*(var(37)>0)
ignorehitpause=1

[State -2, attackincreasereset]
type=varset
triggerall= var(37)
trigger1= movecontact || movereversed
trigger1= stateno!=1500 && (stateno!=1505 || time)
trigger2= (stateno=[801,849]) || (stateno=[851,899]) || (stateno=[1320,1339])
var(37)=0
ignorehitpause=1

[State -2, OTG]
type= varset
trigger1= p2statetype=L
var(24)= 1
ignorehitpause=1

[State -2, OTG]
type= varset
trigger1= movecontact=1 && p2statetype!=L
trigger2= p2statetype!=A && p2statetype!=L
var(24)= 0
ignorehitpause=1

[State -2, Free Juggling]
type=assertspecial
trigger1= var(20)>0 || var(24) || numtarget(3300)
trigger2= roundstate!=2
flag=nojugglecheck
ignorehitpause=1

[State -2, Original Combo Guard]
type=assertspecial
trigger1= var(20)>0
flag= nostandguard
flag2=nocrouchguard
flag3=noairguard
ignorehitpause=1

[State -2, Original Combo PalFX]
type=palfx
trigger1= var(20)>60
time=2
add=32+ceil(sin(var(20)/16.0*pi)*32),32+ceil(sin(var(20)/16.0*pi)*32),32+ceil(sin(var(20)/16.0*pi)*32)
ignorehitpause=1

[State -2, Original Combo PalFX]
type=palfx
trigger1= var(20)=[1,60]
time=2
add=64+ceil(sin(var(20)/8.0*pi)*64),64+ceil(sin(var(20)/8.0*pi)*64),64+ceil(sin(var(20)/8.0*pi)*64)
ignorehitpause=1

[State -2, No Dizzy >:)]
type=selfstate
trigger1= anim=5300
trigger1= numenemy && !pos y
trigger1= enemynear,movetype!=A
trigger1= ((enemy,name="Catwalk") + (enemy,authorname="Phantom.of.the.Server")) != 2
value=0
ctrl=1

[State -2, stopsnd]
type=stopsnd
trigger1= !time && prevstateno=187
channel=4

[State -2, Excel Timer]
type = helper
trigger1 = !numhelper(8305) && var(20) > 0
helpertype = normal
stateno = 8305
ID = 8305
name = "Excel Timer"
postype = p1
ownpal = 1
pausemovetime = 2147483647
supermovetime = 2147483647
ignorehitpause = 1

;===============================================================================
[State -2, VarAdd]
type = varadd
triggerall = Life <= 300
trigger1 = Var(28)<= 2
v = 28
value = 1

[State -2, It's Not Over Yet...]
type = PlaySnd
triggerall = Var(28) = 1
trigger1 = Life <= 300
value = S0,26

[State 0, PlaySnd]
type = PlaySnd
trigger1 = movehit && p2statetype = A && enemy,time = 1 && stateno = 620
value = S800,2
channel = 4

[State 0, PlaySnd]
type = PlaySnd
trigger1 = movehit && p2statetype = A && enemy,time = 1 && stateno = 650
value = S800,2
channel = 4

[State -2,Removeafterimage on get hit]
type = afterimagetime
trigger1 = movetype = H
time = 0

[State -2, Updated Hit Count];special thanks to 20S
type = VarAdd
trigger1 = !IsHelper
trigger1 = MoveHit = 1
trigger1 = !HitPauseTime 
trigger1 = !(HitDefAttr = SCA, AT)
var(13) = 1

[State -2, Hit Count Reset]
type = VarSet
trigger1 = NumEnemy && var(13)
trigger1 = (EnemyNear, MoveType != H) && (EnemyNear, StateNo != 5300)
var(13) = 0
ignoreHitPause = 1

[State -2, Updated Juggle Count];special thanks to 20S
type = VarAdd
trigger1 = !IsHelper
trigger1 = MoveHit = 1
trigger1 = !HitPauseTime
trigger1 = !(HitDefAttr = SCA, AT)
var(15) = 1

[State -2, Juggle Reset Single];updated special thanks to 20S
type = VarSet
triggerAll = NumEnemy = 1 && var(15)
trigger1 = (Enemy, StateType != A) && (Enemy, StateNo != [5100,5109]) && (Enemy, Time >= 0)
trigger2 = (Enemy, MoveType != H) || (Enemy, StateNo = [120,155]) || (Enemy, Ctrl)
var(15) = 0
ignoreHitPause = 1

[State -2, Juggle Reset Simul];updated special thanks to 20S
type = VarSet
triggerAll = NumEnemy >= 2 && var(15)
trigger1 = (EnemyNear(0), StateType != A) && (EnemyNear(0), Time >= 0)
trigger2 = (EnemyNear(0), MoveType != H) || (EnemyNear(0), StateNo = [120,155]) || (EnemyNear(0), Ctrl)
trigger3 = (EnemyNear(1), StateType != A) && (EnemyNear(0), Time >= 0)
trigger4 = (EnemyNear(1), MoveType != H) || (EnemyNear(0), StateNo = [120,155]) || (EnemyNear(0), Ctrl)
var(15) = 0
ignoreHitPause = 1

[State -2, Free Juggling]
type = VarSet
trigger1 = RoundState != 2
var(15) = 0
ignoreHitPause = 1

[State -2, Juggle Flag]
type = VarSet
trigger1 = NumEnemy && !var(16)
trigger1 = (EnemyNear, StateNo = 5040) && !(EnemyNear, Ctrl)
var(16) = 1
ignorehitpause = 1

[State -2, Juggle Flag Reset Single]
type = VarSet
triggerAll = NumEnemy = 1 && var(16)
trigger1 = (Enemy, MoveType != H) && (Enemy, StateNo != 5040)
trigger2 = !(Enemy, HitShakeOver) || (Enemy, StateType = L) || (Enemy, Ctrl)
var(16) = 0
ignoreHitPause = 1

[State -2, Juggle Flag Reset Simul]
type = VarSet
triggerAll = NumEnemy >= 2 && var(16)
trigger1 = (EnemyNear(0), MoveType != H) && (EnemyNear(0), StateNo != 5040)
trigger2 = !(EnemyNear(0), HitShakeOver) || (EnemyNear(0), StateType = L) || (EnemyNear(0), Ctrl)
trigger3 = (EnemyNear(1), MoveType != H) && (EnemyNear(1), StateNo != 5040)
trigger4 = !(EnemyNear(1), HitShakeOver) || (EnemyNear(1), StateType = L) || (EnemyNear(1), Ctrl)
var(16) = 0
ignoreHitPause = 1

[State -2, Assert: UnGuardable]
type = AssertSpecial
trigger1 = var(17) > 0
trigger1 = var(17) := (var(17) - 1)
flag = UnGuardable
ignoreHitPause = 1

[State -2, P2 Recovery]
type = TargetState
trigger1 = NumTarget(200)
trigger1 = (Target(200), StateNo = 5020) && (Target(200), Alive) && (Target(200), HitFall)
ID = 200
value = 5025
ignoreHitPause = 1

[State -2, P2 Facing]
type = TargetFacing
trigger1 = MoveContact = 1 && NumTarget
trigger1 = !(Target, HitShakeOver) && !(Target, HitFall) && (Target, Time <= 1)
value = ifElse(P2Dist x >= 0, -1, 1)
ignoreHitPause = 1

[State -2, P2 Safe Fall]
type = TargetState
trigger1 = NumTarget = 1
trigger1 = Target, command = "recovery"
trigger1 = Target, pos y >= -20 && Target, vel y > 0
trigger1 = Target, Alive && Target, HitFall && Target, GetHitVar(fall.recover)
trigger1 = Target, StateNo = 5030 || Target, StateNo = 5035 || Target, StateNo = 5050 || Target, StateNo = 5071
value = 5205
ignoreHitPause = 1

[State -2, Hit Detection]
type = VarSet
triggerall = stateno != 3353
trigger1 = MoveContact = 1 && var(30) < 0
var(30) = HitPauseTime
ignoreHitPause = 1

[State -2, Hit Sparks]
type = Helper
triggerall = stateno != 3202
triggerAll = MoveContact = 1 && var(30) = HitPauseTime
trigger1 = MoveHit = 1 && NumEnemy
trigger1 = var(33) = 8010 || var(33) = 8011 || var(33) = 8012 || var(33) = 8013 || var(33) = 8014 || var(33)=8015
trigger2 = MoveGuarded = 1 && NumEnemy
trigger2 = var(34) = 8000 || var(34) = 8001
helperType = Normal
stateNo = ifElse(MoveGuarded, var(34), var(33))
ID = 8000
name = "Spark"
postype = P1
pos = ifElse(P2Dist x < 0, 0, ifElse(P2Dist x < var(35), ceil(P2Dist x), var(35))), var(36)
facing = -1
ownPal = 1
pauseMoveTime = 65535
superMoveTime = 65535
ignoreHitPause = 1

[State -2, Counter FX]
type = Helper
trigger1 = MoveHit = 1 && var(30) = HitPauseTime
trigger1 = NumEnemy && var(9)
trigger1 = !(HitDefAttr = SCA, AT) && (EnemyNear, MoveReversed != 1)
helperType = Normal
stateNo = 8290
ID = 8290
name = "Counter FX"
posType = P1
pos = ifElse(P2Dist x < 0, 0, ifElse(P2Dist x < var(35), ceil(P2Dist x), var(35))), var(36)
facing = -1
ownPal = 1
pauseMoveTime = 255
superMoveTime = 255
ignoreHitPause = 1

[State -2, Counter Flag]
type = VarSet
trigger1 = NumEnemy
var(9) = (EnemyNear, MoveType = A)
ignoreHitPause = 1

[State -2, Hit Detection]
type = VarSet
trigger1 = 1
var(30) = -1

[State -2, Hit Detection]
type = VarRangeSet
trigger1 = MoveType = I
trigger2 = MoveType = H && Time
first = 30
last = 36
value = -1
ignoreHitPause = 1

[State -2, Dampener]
type = VarSet
trigger1 = 1
fvar(10) = ifElse(var(13) < 6, 24, ifElse(var(13) >= 23, 1, 29 - var(13))) / 24.0
ignoreHitPause = 1

[State -2, Dampener - Supers]
type = VarSet
trigger1 = (StateNo = [3000,4999])
fvar(10) = ifElse(var(22), 0.6, ifElse(var(21), 0.8, 1.0))
ignoreHitPause = 1

[State -2, Dampener Limit]
type = VarSet
trigger1 = fvar(10) < 0
fvar(10) = 0
ignoreHitPause = 1

[State -2, Root Dampener];Dampener for projectiles
type = VarSet
trigger1 = 1
fvar(11) = fvar(10) * ifElse(var(9), 1.2, 1)
ignoreHitPause = 1

[State -2, Debug Info];Attack strength, # of hits, juggle count
type = DisplayToClipboard
trigger1 = 1
text = "Attack = %f Hits = %d Juggle = %d"
params= fvar(11), var(13), var(15)
ignoreHitPause = 1

[State -2, Debug Info]
type = AppendToClipboard
trigger1 = 1
text = "\nBy Elecbyte+DivineWolf - trinitymugen.net"
ignoreHitPause = 1

[State -2, Voice Position]
type = SndPan
trigger1 = 1
channel = 0
pan = 0
ignoreHitPause = 1

[State -2, Wall Impact Dust];For EX Kung Fu Palm
type = Helper
trigger1 = NumTarget(1030)
trigger1 = (Target(1030), StateNo = 1033) && !NumHelper(8111)
helperType = Normal
stateNo = 8111
ID = 8111
name = "Wall Impact Dust"
posType = P2
facing = -1
pos = Target(1030), Const(size.mid.pos.x) - 10, Target(1030), Const(size.mid.pos.y)
ownPal = 1

[State -2, Ground Impact Dust];Not used, but still added just incase...
type = null;Helper
trigger1 = NumTarget(635)
trigger1 = (Target(635), StateNo = 636) && !NumHelper(8110)
helperType = Normal
stateNo = 8110
ID = 8110
name = "Ground Impact Dust"
posType = P2
facing = -1
pos = 0,0
ownPal = 1

[State -2]
type = removeexplod
triggerall = numtarget
trigger1 = target,stateno = 5100
ID = 8420

[State 0, VarSet]
type = VarSet
trigger1 = pos y = 0
v = 14
value = 0

;---------------------------------------------------------------------------
; States that are executed when in self's state file (use statedef -3)
;---------------------------------------------------------------------------

[Statedef -3]

[State -3, GameTime]
type = VarSet
trigger1 = 1
var(58) = GameTime
ignoreHitPause = 1

;[State -3, ProjContact Reset];only needed for projectile using chars 
;type = VarSet
;triggerAll = var(18)
;trigger1 = 
;var(18) = 0

[State -3, Parry Detection]
type = Helper
triggerall=var(54)<=0
triggerAll = RoundState = 2 && !NumHelper(765) ;&& !var(20)
triggerAll = (MoveType = I && ctrl) || (StateNo = [760,762]) || StateNo = 5120
triggerAll = (command != "rlsfwd" && command != "rlsback" && command != "rlsup" && command != "rlsdown")
trigger1 = (StateType = S || StateType = C || StateNo = 5120) && (command = "fwd" || command = "down")
trigger2 = StateType = A && (var(3) != 1 && var(3) != 2) && command = "fwd"
helperType = Normal
stateNo = 765
ID = 765
name = "Parry Detection"
posType = P1
pauseMoveTime = 65535
superMoveTime = 65535
[State -3, Parry Detection]
type = Helper
triggerall=var(54)>0
triggerAll = RoundState = 2 && NumHelper(765)<2 ;&& !var(20)
triggerAll = (MoveType = I && (ctrl||(stateno=[0,40])||(stateno=[120,149]))) || (StateNo = [760,762]) || StateNo = 5120
trigger1=var(52)-((ceil(var(52)/1000)-ifelse(var(52)-(ceil(var(52)/1000)*1000)<0,1,0))*1000)!=101
helperType = Normal
stateNo = 765
ID = 765
name = "Parry Detection"
posType = P1
pauseMoveTime = 65535
superMoveTime = 65535

[State -3, Parry Attacks]
type = ChangeState
trigger1 = (StateNo != [760,762]) && NumHelper(765)
trigger1 = Helper(765), StateNo = 766
value = ifElse((Helper(765), Anim = 767), 762, ifElse((Helper(765), Anim = 766), 761, 760))
ignoreHitPause = 1

[State -3, Parry Projectiles]
type = HitOverride
trigger1 = (StateNo != [760,762]) && NumHelper(765)
trigger1 = !(Helper(765), var(0)) && (Helper(765), Anim = 765)
attr = SA, AP
stateNo = ifelse(var(54)>0,775,760)
slot = 0
time = 1
ignoreHitPause = 1

[State -3, Parry Projectiles]
type = HitOverride
trigger1 = (StateNo != [760,762]) && NumHelper(765)
trigger1 = !(Helper(765), var(0)) && (Helper(765), Anim = 766)
attr = C, AP
stateNo = ifelse(var(54)>0,776,761)
slot = 0
time = 1
ignoreHitPause = 1

[State -3, Parry Projectiles]
type = HitOverride
trigger1 = (StateNo != [760,762]) && NumHelper(765)
trigger1 = !(Helper(765), var(0)) && (Helper(765), Anim = 767)
attr = SCA, AP
stateNo = ifelse(var(54)>0,777,762)
slot = 0
time = 1
ignoreHitPause = 1

[State -3, Parry Projectiles]
type = HitOverride
triggerall = var(54) && (ctrl||(stateno=[0,40])||(stateno=[120,149])) && statetype!=A
triggerall=var(52)-((ceil(var(52)/1000)-ifelse(var(52)-(ceil(var(52)/1000)*1000)<0,1,0))*1000)!=101
trigger1=var(52)-((ceil(var(52)/1000)-ifelse(var(52)-(ceil(var(52)/1000)*1000)<0,1,0))*1000)=100
trigger2=var(52)-((ceil(var(52)/1000)-ifelse(var(52)-(ceil(var(52)/1000)*1000)<0,1,0))*1000)<100
trigger2=random<=(var(52)-((ceil(var(52)/1000)-ifelse(var(52)-(ceil(var(52)/1000)*1000)<0,1,0))*1000))*100
attr = SA, AP
stateNo = ifelse(var(54)>0,775,760)
slot = 1
time = 1
ignoreHitPause = 1

[State -3, Parry Projectiles]
type = HitOverride
triggerall = var(54) && (ctrl||(stateno=[0,40])||(stateno=[120,149])) && statetype!=A
triggerall=var(52)-((ceil(var(52)/1000)-ifelse(var(52)-(ceil(var(52)/1000)*1000)<0,1,0))*1000)!=101
trigger1=var(52)-((ceil(var(52)/1000)-ifelse(var(52)-(ceil(var(52)/1000)*1000)<0,1,0))*1000)=100
trigger2=var(52)-((ceil(var(52)/1000)-ifelse(var(52)-(ceil(var(52)/1000)*1000)<0,1,0))*1000)<100
trigger2=random<=(var(52)-((ceil(var(52)/1000)-ifelse(var(52)-(ceil(var(52)/1000)*1000)<0,1,0))*1000))*100
attr = C, AP
stateNo = ifelse(var(54)>0,776,761)
slot = 2
time = 1
ignoreHitPause = 1

[State -3, Parry Projectiles]
type = HitOverride
triggerall = var(54) && (ctrl||(stateno=[0,40])||(stateno=[120,149])) && statetype=A
triggerall=var(52)-((ceil(var(52)/1000)-ifelse(var(52)-(ceil(var(52)/1000)*1000)<0,1,0))*1000)!=101
trigger1=var(52)-((ceil(var(52)/1000)-ifelse(var(52)-(ceil(var(52)/1000)*1000)<0,1,0))*1000)=100
trigger2=var(52)-((ceil(var(52)/1000)-ifelse(var(52)-(ceil(var(52)/1000)*1000)<0,1,0))*1000)<100
trigger2=random<=(var(52)-((ceil(var(52)/1000)-ifelse(var(52)-(ceil(var(52)/1000)*1000)<0,1,0))*1000))*100
attr = SCA, AP
stateNo = ifelse(var(54)>0,777,762)
slot = 3
time = 1
ignoreHitPause = 1

[State -3, Assert: NoWalk after Parry]
type = AssertSpecial
trigger1 = var(26) > 0
trigger1 = var(26) := (var(26)-1)
flag = NoWalk

[State -3, Corner Push]
type = VarSet
triggerAll = fvar(5)
trigger1 = abs(fvar(5)) <= (1 / 0.85)
trigger2 = NumTarget
trigger2 = Target, GetHitVar(HitTime) <= 0 || (Target, GetHitVar(HitShakeTime) > 0 && Target, Time <= 0)
fvar(5) = 0

[State -3, Corner Push]
type = VarSet
trigger1 = NumTarget
trigger1 = Target, GetHitVar(HitShakeTime) <= 0
fvar(5) = fvar(5) * 0.85

[State -3, Corner Push]
type = VarSet
triggerall = movetype != H
trigger1 = MoveContact = 1 && NumTarget
fvar(5) = Target, GetHitVar(xVel)
ignoreHitPause = 1

[State -3, Corner Push]
type = PosAdd
triggerAll = fvar(5)
triggerAll = (StateType = S || StateType = C) && NumTarget
triggerAll = !HitPauseTime && Target, GetHitVar(HitShakeTime) <= 1
triggerAll = (Target, StateType = S || Target, StateType = C) && !(Target, GetHitVar(yVel)) && !(Target, HitFall)
trigger1 = Target, FrontEdgeBodyDist <= 0 && (Target, GetHitVar(xVel) * Target, Facing) > 0
trigger2 = Target, BackEdgeBodyDist <= 0 && (Target, GetHitVar(xVel) * Target, Facing) < 0
x = ifElse(Target, FrontEdgeBodyDist <= 0, -1, 1) * (Target, Facing) * fvar(5)

[State -3, Cheap KO]
type = ChangeState
trigger1 = !Alive && (StateNo = [5000,5010])
trigger1 = (PrevStateNo = [130,131]) || (PrevStateNo = [140,141]) || (PrevStateNo = [150,153])
value = 5950
ignoreHitPause = 1

[State -3, Assert: NoKOsnd (Cheap KO)]
type = AssertSpecial
trigger1 = (StateNo = [5000,5010])
trigger1 = (PrevStateNo = [130,131]) || (PrevStateNo = [140,141]) || (PrevStateNo=[150,153])
flag = NoKOsnd
ignoreHitPause = 1

[State -3, Get Hit Sound]
type = PlaySnd
triggerAll = Alive && Time = 1
triggerAll = StateNo = 5000 || StateNo = 5010
trigger1 = GetHitVar(AnimType) >= 2 && Random < 500
trigger2 = GetHitVar(AnimType) = 1 && Random < 375
trigger3 = GetHitVar(AnimType) = 0 && Random < 250
value = 5000,(Random % 3)
channel = 0
ignoreHitPause = 1

[State -3, Get Hit Sound]
type = PlaySnd
triggerAll = Alive && Time = 1
trigger1 = (StateNo = 5000 || StateNo = 5010) && NumEnemy
trigger1 = GetHitVar(fall) || (EnemyNear, HitDefAttr = SCA,SA,HA)
trigger2 = (StateNo = 5020 || StateNo = 5070 || StateNo = 5080)
trigger3 = (StateNo = 5050 || StateNo = 5100) && (PrevStateNo != [5000,5199])
value = 5000,(Random % 3)
channel = 0
ignoreHitPause = 1

[State -3, Special Cancel Reset]
type = VarSet
trigger1 = 1
var(5) = 0
ignoreHitPause = 1

[State -3, Special Cancel Check]
type = VarSet
trigger1= (stateno = [200,699]) && Time <= 2
trigger2= (stateno=[200,221]) && movecontact
trigger3= (stateno=[230,240]) && movecontact
trigger4= (stateno=[400,450]) && movecontact
var(5) = 1
ignoreHitPause = 1

[State -3, Super Cancel Reset]
type = VarSet
trigger1 = 1
var(6) = 0
ignoreHitPause = 1

[State -3, Super Cancel Check]
type = VarSet
trigger1 = (stateno=[200,430]) && movecontact
trigger2 = (stateno = [1200,1202]) && movecontact
trigger3 = stateno = 1100 && movecontact
trigger4 = stateno = 1101 && AnimElemtime(3) < 0 && movecontact
trigger5 = stateno = 1102 && AnimElemtime(6) < 0 && movecontact
trigger6 = (stateno = [1240,1242]) && movecontact
trigger7 = stateno = 1106 && movecontact
trigger8 = stateno = 1107 && AnimElemtime(3) > 0 && movecontact
trigger9 = stateno = 1108 && AnimElemtime(6) > 0 && movecontact
var(6) = 1
ignoreHitPause = 1

[State -3, MAX Cancel Reset]
type = VarSet
trigger1 = 1
var(7) = 0
ignoreHitPause = 1

[State -3, MAX Cancel Check]
type = VarSet
trigger1= (stateno= 3000 && movecontact) && (animelemtime(29)<0) 
var(7) = 1
ignoreHitPause = 1

[State -3, Underground Juggle Prevention]
type = TargetBind
trigger1 = MoveContact = 1
trigger1 = NumTarget = 1 && NumEnemy
trigger1 = (Target, Time = 0) && (Target, ID = EnemyNear, ID)
trigger1 = !(Target, HitShakeOver) && (Target, Pos y > 0)
pos = ceil(P2dist x), ceil(-pos y)
ignorehitpause = 1

[State -3, Prevent Crossup]
type = Width
trigger1 = 1
edge = 8,0
ignoreHitPause = 1

[State -3, Variable Height]
type = PlayerPush
triggerAll = StateType = A && MoveType != H && NumEnemy
triggerAll = P2BodyDist x = [-(EnemyNear, const(size.ground.back) + EnemyNear, const(size.ground.front)), 0]
trigger1 = P2StateType = S
trigger1 = P2Dist y >= (EnemyNear, const(size.height) - 12)
trigger2 = P2StateType = C
trigger2 = P2Dist y >= (EnemyNear, const(size.height) - 28)
trigger3 = P2StateType = L
trigger3 = P2Dist y >= 12
value = 0
ignoreHitPause = 1

[State -3, moveshadow]
type=afterimage
triggerall= var(20)>0
trigger1= time=1
time=2
timegap=1
framegap=4
length=9
palbright=0,0,0
paladd=0,0,0
palmul=.9,.9,.9
palcontrast=120,120,120
palpostbright=0,0,0
trans=add1

[State -3, AfterImagePersist]
type=afterimagetime
trigger1= var(20)>0
time=2

[State -3, Movement AfterImage]
type = AfterImage
triggerall = NumHelper(330) = 0
triggerAll = Time = 1 
trigger1 = StateNo = 50 && (var(3) = 2 || var(3) = 3)
time = 30
TimeGap  = 1
FrameGap = 4
length = 15
palbright=0,0,0
paladd=0,0,0
palmul=.9,.9,.9
PalContrast = 180,70,70
palpostbright=0,0,0
trans=add1

[State -3, Movement AfterImage]
type = AfterImage
triggerall = NumHelper(330) = 0
triggerAll = Time = 1
trigger1 = (StateNo = [700,715])
time = 2
timeGap = 1
frameGap = 4
length = 9
palBright = 0,0,0
palContrast = 128,128,128
palPostBright = 0,0,0
palAdd = 0,0,0
palMul = 0.9,0.9,0.9
trans = Add1

[State -3, EX FX Decrement]
type = VarAdd
trigger1 = var(25) > 0
var(25) = -1

[State -3, EX FX Reset]
type = VarSet
trigger1 = (StateNo != [1000,2999]) || MoveType = H
var(25) = 0

[State -3, EX Flash]
type = PalFX
triggerall = var(8) = 0
trigger1 = !(GameTime % 2) && var(25)
time = 1
color = 0
mul = 256, 224, 0
add = 128, 128, 128
ignoreHitPause = 1

[State -3, dash AfterImage]
type = AfterImage
triggerall = NumHelper(330) = 0
trigger1 = StateNo = 100 && Time = 3
trigger2 = StateNo = 102 && Time = 3
time = 20
TimeGap  = 1
FrameGap = 4
length = 15

[State -3, dash AfterImage]
type = AfterImage
triggerall = NumHelper(330) = 0
trigger1 = StateNo = 100 && Time = 3
trigger2 = StateNo = 102 && Time = 3
time = 20
TimeGap  = 1
FrameGap = 4
length = 15
palbright=0,0,0
paladd=0,0,0
palmul=.9,.9,.9
PalContrast = 180,70,70
palpostbright=0,0,0
trans=add1

[State -3, Level 1 Super AfterImage]
type = AfterImage
trigger1 = StateNo = 3000 && Time = 3
trigger2 = StateNo = 3100 && Time = 3
trigger3 = StateNo = 3300 && Time = 3
time = 2
timeGap = 1
frameGap = 10
length = 21
palBright = 0,0,0
palContrast = 128,128,128
palPostBright = 0,0,0
palAdd = 0,0,0
palMul = 0.75,0.75,0.75
trans = Add1
ownpal = 1

[State -3, Level 2 Super AfterImage]
type = AfterImage
trigger1 = StateNo = 3002 && Time = 3
trigger2 = StateNo = 3110 && Time = 3
trigger3 = StateNo = 3350 && Time = 3
time = 2
timeGap = 1
framegap = 10
length = 21
palBright = 0,0,0
palContrast = 32,32,160
palPostBright = 0,0,0
palAdd = 0,0,0
palMul = 0.75,0.75,0.75
trans = Add1

[State -3, Level 3 Super AfterImage]
type = AfterImage
trigger1 = StateNo = 3025 && Time = 3
trigger2 = StateNo = 3026 && Time = 3
trigger3 = StateNo = 3200 && Time = 3
;trigger4 = StateNo = 3200 && Time = 3
time = 2
timeGap = 1
frameGap = 10
length = 21
palBright = 0,0,0
palContrast = 160,32,32
palPostBright = 0,0,0
palAdd = 0,0,0
palMul= 0.75,0.75,0.75
trans = Add1

[State -3, AfterImage Persist]
type = AfterImageTime
trigger1 = StateNo = 50 || (StateNo = [600,699])
trigger1 = (var(3) = 2 || var(3) = 3) && vel y < -1
trigger2 = StateNo = [700,715]
trigger3 = StateNo = [3000,4999]
time = 2

[State -3, AfterImage Off]
type = AfterImageTime
triggerAll = Time <= 1
trigger1 = StateNo = 3000 || StateNo = 3050 ;|| StateNo = 300
trigger2 = Stateno = 3100 || StateNo = 3101
time = 0

[State -3, Special Finish]
type = Helper
triggerall = roundstate >= 2
triggerall = WinKo && NumHelper(8700)=0 && !var(20) && !var(24)
trigger1 = (stateno = [1000, 2999])&&movetype!=H
ID = 8700
stateno = 8700
postype = back
pos = 0,0
pausemovetime = 999999
supermovetime = 999999
ignorehitpause = 1
ownpal = 1
persistent=0

[State -3, Super Finish]
type = Helper
triggerAll = WinKO && RoundState = 3 && !NumHelper(8600)
trigger1 = MoveHit = 1 && (StateNo = [3000,4999])
trigger1 = var(23) := StateNo
trigger2 = (StateNo = [3000,4999])
trigger2 = var(23) := 3000
trigger3 = StateNo = 3100
trigger3 = var(23) := 3100
trigger4 = Var(2) > 0
trigger5 = var(20) > 0
helperType = Normal
stateNo = 8600
ID = 8600
name = "Super Finish"
posType = left
pos = 160,-120
ownPal = 1
pauseMoveTime = 255
superMoveTime = 255
ignoreHitPause = 1

[State -3, Underground Juggle Prevention]
type = targetbind
trigger1 = movecontact = 1
trigger1 = numtarget && numenemy
trigger1 = (target, time = 0) && (target, ID = enemynear, ID)
trigger1 = !(target, hitshakeover) && (target, pos y > 0)
pos = ceil(p2dist x), ceil(-pos y)
ignorehitpause = 1

;------------------------------------------------------------
; Mode Type Variable
;------------------------------------------------------------
[State -3, VarSet]
type = VarSet
trigger1 = 1
v = 40
value = 10

;------------------------------------------------------------
; Clipboard Display Variables
;------------------------------------------------------------

[State -3, Variables]
type = DisplayToClipboard
triggerall = Var(40) = 10
trigger1 = NumHelper(1050) > 0
trigger2 = NumHelper(1051) > 0
trigger3 = NumHelper(1052) > 0
text = "Counter = %d  Z-Charge:%d"
params = Var(28), Var(18)

[State -3, Variables]
type = DisplayToClipboard
triggerall = Var(40) = 10
trigger1 = NumHelper(1050) = 0
trigger1 = NumHelper(1051) = 0
trigger1 = NumHelper(1052) = 0
text = "Counter = %d"
params = Var(28)

